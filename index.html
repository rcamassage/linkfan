<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마사지샵 관리 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Sans+Thai:wght@300;400;500;700&family=Noto+Sans+Vietnamese:wght@300;400;500;700&family=Roboto:wght@300;400;500;700&family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        .remaining-time {
            font-size: 2rem;
            font-weight: bold;
            color: #ef4444;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80%;
            overflow-y: auto;
        }
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .selection-item {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .selection-item:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .selection-item.selected {
            border-color: #3b82f6;
            background-color: #3b82f6;
            color: white;
        }
        .edit-row {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-full">
    <!-- 로그인 화면 -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2" data-translate="title">마사지샵 관리 시스템</h1>
                <div class="w-20 h-1 bg-blue-500 mx-auto"></div>
            </div>
            
            <!-- 언어 선택 -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">언어 선택 / Language / ภาษา / Ngôn ngữ</label>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="setLanguage('ko')" class="bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600" id="langKo">한국어</button>
                    <button onclick="setLanguage('en')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langEn">English</button>
                    <button onclick="setLanguage('th')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langTh">ไทย</button>
                    <button onclick="setLanguage('vi')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langVi">Tiếng Việt</button>
                </div>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="username">아이디</label>
                    <input type="text" id="loginUsername" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" data-translate-placeholder="usernameInput">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="password">비밀번호</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" data-translate-placeholder="passwordInput">
                </div>
                <button onclick="processLogin()" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition duration-200" data-translate="login">로그인</button>
            </div>
        </div>
    </div>



    <!-- 메인 화면 -->
    <div id="mainScreen" class="container mx-auto p-6" style="display: none;">
        <!-- 헤더 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800" data-translate="title">마사지 관리 프로그램</h1>
                    <p id="shopName" class="text-lg text-gray-600 mt-1"></p>
                </div>
                <div class="flex gap-2">
                    <button onclick="showLanguageModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="changeLanguage">언어 변경</button>
                    <button onclick="showFontModal()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600" data-translate="changeFont">폰트 변경</button>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" data-translate="logout">로그아웃</button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="text-center">
                    <label class="block text-sm font-medium mb-2" data-translate="todayDate">오늘 날짜</label>
                    <div class="flex gap-2">
                        <input type="date" id="currentDate" class="border rounded px-3 py-2 flex-1">
                        <button onclick="confirmDateChange()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="confirmDate">확인</button>
                    </div>
                </div>
                <div class="text-center">
                    <label class="block text-sm font-medium mb-2" data-translate="currentTime">현재 시간</label>
                    <div id="currentTime" class="text-xl font-bold text-blue-600"></div>
                </div>
            </div>
        </div>

        <!-- 메뉴 버튼들 -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
            <button onclick="showDashboard()" class="bg-blue-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-blue-600" data-translate="dashboard">현황판</button>
            <button onclick="showOrder()" class="bg-indigo-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-indigo-600" data-translate="order">순번</button>
            <button onclick="showReservation()" class="bg-green-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-green-600" data-translate="reservation">예약</button>
            <button onclick="showStatistics()" class="bg-purple-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-purple-600" data-translate="statistics">통계</button>
            <button onclick="showDBManagement()" class="bg-orange-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-orange-600" data-translate="dbManagement">DB 관리</button>
        </div>

        <!-- 순번 섹션 -->
        <div id="orderSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="orderManagement">순번 관리</h2>
            <div class="mb-4">
                <button onclick="saveStaffOrder()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="saveOrder">순번 저장</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2" data-translate="staffName">직원명</th>
                            <th class="border border-gray-300 p-2" data-translate="status">상태</th>
                            <th class="border border-gray-300 p-2" data-translate="orderNumber">순번</th>
                        </tr>
                    </thead>
                    <tbody id="orderTable">
                    </tbody>
                </table>
            </div>
            <div class="mt-4 text-sm text-gray-600" data-translate="orderZeroVacationNote">
                * 순번 0은 휴가로 처리됩니다.
            </div>
        </div>

        <!-- 현황판 -->
        <div id="dashboardSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="dashboard">현황판</h2>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2" data-translate="staff">직원명</th>
                            <th class="border border-gray-300 p-2" data-translate="menu">메뉴</th>
                            <th class="border border-gray-300 p-2" data-translate="duration">시간</th>
                            <th class="border border-gray-300 p-2" data-translate="startTime">시작시간</th>
                            <th class="border border-gray-300 p-2" data-translate="endTime">끝시간</th>
                            <th class="border border-gray-300 p-2" data-translate="remainingTime">남은시간</th>
                            <th class="border border-gray-300 p-2" data-translate="price">가격</th>
                            <th class="border border-gray-300 p-2" data-translate="commission">커미션</th>
                            <th class="border border-gray-300 p-2" data-translate="roomNumber">방번호</th>
                            <th class="border border-gray-300 p-2" data-translate="actions">작업</th>
                        </tr>
                    </thead>
                    <tbody id="dashboardTable">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 예약 섹션 -->
        <div id="reservationSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="reservation">예약</h2>
            
            <!-- 마사지사 선택 -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2" data-translate="selectStaff">마사지사 선택</label>
                <div id="staffSelection" class="selection-grid"></div>
            </div>

            <!-- 다중 메뉴 추가 섹션 -->
            <div id="multiMenuSection" class="hidden">
                 <!-- 메뉴 선택 -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" data-translate="selectMenu">메뉴 선택</label>
                    <div id="menuSelection" class="selection-grid"></div>
                </div>

                <!-- 시간 선택 -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" data-translate="duration">시간 선택</label>
                    <div id="durationSelection" class="selection-grid"></div>
                </div>

                <!-- 추가 옵션들 -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium mb-2" data-translate="startTime">시작 시간 (선택사항)</label>
                        <input type="time" id="reservationStartTime" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2" data-translate="roomNumber">방번호 (선택사항)</label>
                        <select id="reservationRoom" class="w-full border rounded px-3 py-2">
                            <option value="" data-translate="selectRoom">방 선택</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2" data-translate="customerName">고객명 (선택사항)</label>
                        <input type="text" id="reservationCustomer" class="w-full border rounded px-3 py-2" data-translate-placeholder="enterCustomerName">
                    </div>
                </div>
            </div>
            
             <!-- 선택된 메뉴 목록 -->
            <div id="pendingReservationsContainer" class="mb-4"></div>

            <!-- 가격 정보 -->
            <div class="mb-4 p-4 bg-gray-100 rounded">
                <div class="grid grid-cols-2 gap-4">
                    <div><strong data-translate="price">가격:</strong> <span id="reservationPrice">0</span><span id="reservationPriceCurrency"></span></div>
                    <div><strong data-translate="commission">커미션:</strong> <span id="reservationCommission">0</span><span id="reservationCommissionCurrency"></span></div>
                </div>
            </div>

            <div class="flex gap-4">
                <button onclick="addMenuItem()" class="bg-indigo-500 text-white px-6 py-2 rounded hover:bg-indigo-600" data-translate="addMenuItem">메뉴 +</button>
                <button onclick="addReservation()" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600" data-translate="addReservation">예약 추가</button>
            </div>
        </div>

        <!-- 통계 섹션 -->
        <div id="statisticsSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="statistics">통계</h2>
            <div class="mb-4 flex gap-4 flex-wrap">
                <button onclick="showDailyStats()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="daily">일간</button>
                <button onclick="showWeeklyStats()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="weekly">주간</button>
                <button onclick="showMonthlyStats()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600" data-translate="monthly">월간</button>
                <button onclick="showMenuChart()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600" data-translate="monthlyMenuChart">월간 메뉴 그래프</button>
                <button onclick="showMonthlyChart()" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600" data-translate="monthlyChart">월간 매출 그래프</button>
                <button onclick="downloadExcel()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700" data-translate="download">다운로드</button>
            </div>
            <div class="mb-4 flex gap-4 items-center" id="statsDateContainer">
                <input type="date" id="statsDate" class="border rounded px-3 py-2">
                <div id="statsDateRange" class="flex gap-4 items-center hidden">
                    <span>~</span>
                    <input type="date" id="statsEndDate" class="border rounded px-3 py-2">
                </div>
                <button id="statsConfirmBtn" onclick="updateStats()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 hidden" data-translate="confirm">확인</button>
            </div>
            
            <!-- 차트 영역 -->
            <div id="chartContainer" class="mb-6" style="display: none;">
                <canvas id="statsChart" width="800" height="400"></canvas>
            </div>
            
            <!-- 직원별 통계 -->
            <div class="mb-6">
                <h3 class="text-lg font-bold mb-2" id="statsTableTitle" data-translate="staffStatisticsTitle">직원별 통계</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead id="statsTableHeader">
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2" data-translate="staff">마사지사</th>
                                <th class="border border-gray-300 p-2" data-translate="totalPrice">총 가격</th>
                                <th class="border border-gray-300 p-2" data-translate="totalCommission">총 커미션</th>
                            </tr>
                        </thead>
                        <tbody id="statsTable">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 입금방식별 통계 -->
            <div class="mb-6" id="paymentStatsContainer">
                <h3 class="text-lg font-bold mb-2" data-translate="paymentMethodStatisticsTitle">입금방식별 통계</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2" data-translate="paymentMethodColumn">입금방식</th>
                                <th class="border border-gray-300 p-2" data-translate="amountColumn">금액</th>
                            </tr>
                        </thead>
                        <tbody id="paymentStatsTable">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="p-4 bg-gray-100 rounded">
                <div class="grid grid-cols-3 gap-4">
                    <div><strong data-translate="grandTotal">총 금액(QR팁 제외):</strong> <span id="grandTotalPrice">0</span><span id="grandTotalCurrency"></span></div>
                    <div><strong data-translate="grandTotalCommission">총 커미션:</strong> <span id="grandTotalCommission">0</span><span id="grandTotalCommissionCurrency"></span></div>
                    <div><strong data-translate="profit">수익:</strong> <span id="totalProfit">0</span><span id="totalProfitCurrency"></span></div>
                </div>
            </div>
        </div>

        <!-- DB 관리 섹션 -->
        <div id="dbManagementSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="dbManagement">DB 관리</h2>
            
            <!-- 데이터 백업/복원 -->
            <div class="mb-6 p-4 bg-gray-100 rounded">
                <h3 class="text-lg font-bold mb-2" data-translate="dataBackupRestoreTitle">데이터 백업 및 복원</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold mb-2" data-translate="backupButton">백업</h4>
                        <div class="flex gap-2 flex-wrap">
                            <button onclick="showLocalBackupDialog()" class="bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 text-sm" data-translate="localBackupButton">로컬 백업</button>
                            <button onclick="showGoogleBackupDialog()" class="bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm" data-translate="googleBackupButton">구글 백업</button>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2" data-translate="restoreButton">복원</h4>
                        <div class="flex gap-2 flex-wrap">
                            <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(event)">
                            <button onclick="showLocalRestoreDialog()" class="bg-orange-600 text-white px-3 py-2 rounded hover:bg-orange-700 text-sm" data-translate="localRestoreButton">로컬 복원</button>
                            <button onclick="showGoogleRestoreDialog()" class="bg-indigo-600 text-white px-3 py-2 rounded hover:bg-indigo-700 text-sm" data-translate="googleRestoreButton">구글 복원</button>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <button onclick="exportAllDataExcel()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700" data-translate="exportAllDataButton">전체 데이터 엑셀 내보내기</button>
                </div>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="manageMenus()" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600" data-translate="menuManagement">메뉴 관리</button>
                <button onclick="manageStaff()" class="bg-green-500 text-white py-3 px-4 rounded hover:bg-green-600" data-translate="staffManagement">직원 관리</button>
                <button onclick="manageRooms()" class="bg-purple-500 text-white py-3 px-4 rounded hover:bg-purple-600" data-translate="roomManagement">방 관리</button>
                <button onclick="manageCustomers()" class="bg-orange-500 text-white py-3 px-4 rounded hover:bg-orange-600" data-translate="customerManagement">고객 관리</button>
                <button onclick="manageCurrency()" class="bg-pink-500 text-white py-3 px-4 rounded hover:bg-pink-600" data-translate="currencyManagement">화폐 단위</button>
                <button onclick="managePaymentMethods()" class="bg-yellow-500 text-white py-3 px-4 rounded hover:bg-yellow-600" data-translate="paymentMethodManagement">입금방식 관리</button>
                <button onclick="manageGuarantee()" class="bg-teal-500 text-white py-3 px-4 rounded hover:bg-teal-600" data-translate="guaranteeManagement">Guarantee</button>
                <div id="superAdminButtons" style="display: none;">
                    <button onclick="manageAdmins()" class="bg-red-500 text-white py-3 px-4 rounded hover:bg-red-600" data-translate="adminManagement">관리자 관리</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 입금 모달 -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4" data-translate="payment">입금 처리</h3>
            <div id="paymentMethods" class="space-y-4 mb-4">
            </div>
            <div class="mb-4">
                <strong data-translate="totalAmount">총 금액:</strong> <span id="paymentTotalAmount">0</span><span id="paymentCurrency"></span>
            </div>
            <div class="mb-4">
                <strong data-translate="enteredAmount">입력된 금액:</strong> <span id="paymentEnteredAmount">0</span><span id="paymentEnteredCurrency"></span>
            </div>
            <div class="flex gap-2">
                <button onclick="processPayment()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="confirm">확인</button>
                <button onclick="closePaymentModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="cancel">취소</button>
            </div>
        </div>
    </div>

    <!-- 예약 수정 모달 -->
    <div id="editReservationModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4" data-translate="editReservation">예약 수정</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2" data-translate="selectMenu">메뉴 선택</label>
                    <select id="editMenuSelect" class="w-full border rounded px-3 py-2"></select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2" data-translate="duration">시간 선택</label>
                    <select id="editDurationSelect" class="w-full border rounded px-3 py-2"></select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2" data-translate="startTime">시작 시간</label>
                    <input type="time" id="editStartTime" class="w-full border rounded px-3 py-2">
                </div>
            </div>
            <div class="flex gap-2 mt-6">
                <button onclick="saveEditedReservation()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="save">저장</button>
                <button onclick="closeEditReservationModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="cancel">취소</button>
            </div>
        </div>
    </div>


    <!-- 범용 관리 모달 -->
    <div id="managementModal" class="modal">
        <div class="modal-content">
            <h3 id="managementTitle" class="text-xl font-bold mb-4"></h3>
            <div id="managementContent"></div>
            <button onclick="closeManagementModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="close">닫기</button>
        </div>
    </div>

    <!-- 언어 변경 모달 -->
    <div id="languageModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">언어 선택 / Language / ภาษา / Ngôn ngữ</h3>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="setLanguageAndClose('ko')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">한국어</button>
                <button onclick="setLanguageAndClose('en')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">English</button>
                <button onclick="setLanguageAndClose('th')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">ไทย</button>
                <button onclick="setLanguageAndClose('vi')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">Tiếng Việt</button>
            </div>
            <button onclick="closeLanguageModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">닫기</button>
        </div>
    </div>

    <!-- 폰트 변경 모달 -->
    <div id="fontModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4" data-translate="fontSelection">폰트 선택</h3>
            
            <!-- 폰트 사이즈 선택 -->
            <div class="mb-6 p-4 bg-gray-50 rounded">
                <h4 class="font-bold mb-3" data-translate="fontSize">폰트 크기</h4>
                <div class="grid grid-cols-5 gap-2">
                    <button onclick="setFontSize('small')" id="fontSizeSmall" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeSmall">작게</button>
                    <button onclick="setFontSize('normal')" id="fontSizeNormal" class="bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600" data-translate="fontSizeNormal">보통</button>
                    <button onclick="setFontSize('large')" id="fontSizeLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeLarge">크게</button>
                    <button onclick="setFontSize('xlarge')" id="fontSizeXLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeXLarge">매우 크게</button>
                    <button onclick="setFontSize('xxlarge')" id="fontSizeXXLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeXXLarge">최대</button>
                </div>
                <div class="mt-2 text-sm text-gray-600" data-translate="fontSizePreview">
                    <span id="fontSizePreview">미리보기 텍스트 - Preview Text - ตัวอย่างข้อความ - Văn bản xem trước</span>
                </div>
            </div>

            <!-- 폰트 종류 선택 -->
            <div class="mb-4">
                <h4 class="font-bold mb-3" data-translate="fontFamily">폰트 종류</h4>
                <div class="grid grid-cols-1 gap-3">
                    <button onclick="setFontFamily('Arial')" id="fontFamilyArial" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600" style="font-family: Arial;">Arial (기본)</button>
                    <button onclick="setFontFamily('Noto Sans KR')" id="fontFamilyNotoKR" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans KR', sans-serif;">Noto Sans KR (한글 최적화)</button>
                    <button onclick="setFontFamily('Malgun Gothic')" id="fontFamilyMalgun" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Malgun Gothic', sans-serif;">맑은 고딕</button>
                    <button onclick="setFontFamily('Nanum Gothic')" id="fontFamilyNanum" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Nanum Gothic', sans-serif;">나눔고딕</button>
                    <button onclick="setFontFamily('Roboto')" id="fontFamilyRoboto" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Roboto', sans-serif;">Roboto (영문 최적화)</button>
                    <button onclick="setFontFamily('Noto Sans Thai')" id="fontFamilyThai" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans Thai', sans-serif;">Noto Sans Thai (태국어)</button>
                    <button onclick="setFontFamily('Noto Sans Vietnamese')" id="fontFamilyVietnamese" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans Vietnamese', sans-serif;">Noto Sans Vietnamese (베트남어)</button>
                </div>
            </div>

            <div class="flex gap-2">
                <button onclick="applyFontSettings()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="apply">적용</button>
                <button onclick="closeFontModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="close">닫기</button>
            </div>
        </div>
    </div>

    <!-- 구글 로그인 모달 -->
    <div id="googleLoginModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">구글 계정 로그인</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">구글 이메일:</label>
                    <input type="email" id="googleEmail" class="w-full border rounded px-3 py-2" placeholder="example@gmail.com">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">구글 비밀번호:</label>
                    <input type="password" id="googlePassword" class="w-full border rounded px-3 py-2" placeholder="비밀번호 입력">
                </div>
                <div class="text-sm text-gray-600">
                    * 실제 구글 계정 정보를 입력하세요. 백업/복원을 위해 구글 드라이브에 접근합니다.
                </div>
            </div>
            <div class="flex gap-2 mt-4">
                <button id="googleLoginConfirm" onclick="processGoogleLogin()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">로그인</button>
                <button onclick="closeGoogleLoginModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let currentLanguage = 'ko';
        let currentFont = 'Arial';
        let currentFontSize = 'normal';
        let selectedFontFamily = 'Arial';
        let selectedFontSize = 'normal';
        let currentAdmin = null;
        let currentPaymentReservationId = null;
        let currentEditingReservationId = null;
        let selectedStaff = null;
        let selectedMenu = null;
        let selectedDuration = null;
        let pendingReservationItems = [];
        let currentStatsType = 'daily';


        // 번역 데이터
        const translations = {
            ko: {
                title: '마사지 관리 프로그램',
                changeLanguage: '언어 변경',
                changeFont: '폰트 변경',
                fontSelection: '폰트 선택',
                fontSize: '폰트 크기',
                fontFamily: '폰트 종류',
                fontSizeSmall: '작게',
                fontSizeNormal: '보통',
                fontSizeLarge: '크게',
                fontSizeXLarge: '매우 크게',
                fontSizeXXLarge: '최대',
                fontSizePreview: '미리보기 텍스트',
                apply: '적용',
                logout: '로그아웃',
                todayDate: '오늘 날짜',
                currentTime: '현재 시간',
                dashboard: '현황판',
                order: '순번',
                reservation: '예약',
                statistics: '통계',
                dbManagement: 'DB 관리',
                staff: '직원명',
                menu: '메뉴',
                duration: '시간',
                startTime: '시작시간',
                endTime: '끝시간',
                remainingTime: '남은시간',
                price: '가격',
                commission: '커미션',
                roomNumber: '방번호',
                actions: '작업',
                selectStaff: '마사지사 선택',
                selectMenu: '메뉴 선택',
                customerName: '고객명',
                addReservation: '예약 추가',
                addMenuItem: '메뉴 +',
                daily: '일간',
                weekly: '주간',
                monthly: '월간',
                totalPrice: '총 가격',
                totalCommission: '총 커미션',
                grandTotal: '총 금액(QR Tip 제외)',
                grandTotalCommission: '총 커미션',
                profit: '수익',
                menuManagement: '메뉴 관리',
                staffManagement: '직원 관리',
                roomManagement: '방 관리',
                customerManagement: '고객 관리',
                adminManagement: '관리자 관리',
                currencyManagement: '화폐 단위',
                paymentMethodManagement: '입금방식 관리',
                guaranteeManagement: 'Guarantee',
                payment: '입금 처리',
                totalAmount: '총 금액',
                enteredAmount: '입력된 금액',
                confirm: '확인',
                cancel: '취소',
                login: '로그인',
                close: '닫기',
                edit: '수정',
                delete: '삭제',
                add: '추가',
                save: '저장',
                username: '아이디',
                password: '비밀번호',
                usernameInput: '아이디를 입력하세요',
                passwordInput: '비밀번호를 입력하세요',
                staffName: '직원명',
                phoneNumber: '전화번호',
                bankName: '은행명',
                accountNumber: '계좌번호',
                status: '상태',
                roomNum: '방번호',
                customerNum: '고객번호',
                paymentMethodName: '입금방식명',
                shopName: '가게명',
                adminType: '타입',
                orderManagement: '순번 관리',
                saveOrder: '순번 저장',
                orderNumber: '순번',
                paymentComplete: '입금 완료',
                complete: '완료',
                fullTime: '정직원',
                partTime: '단기고용',
                resigned: '퇴사',
                vacation: '휴가',
                minutes30: '30분',
                minutes60: '60분',
                minutes90: '90분',
                minutes120: '120분',
                orderZeroNote: '* 순번 0은 휴가로 처리됩니다',
                selectRoom: '방 선택',
                enterCustomerName: '고객명 입력',
                monthlyMenuChart: '월간 메뉴 그래프',
                monthlyChart: '월간 매출 그래프',
                download: '다운로드',
                staffStats: '직원별 통계',
                paymentMethodStats: '입금방식별 통계',
                paymentMethod: '입금방식',
                amount: '금액',
                dataBackupRestore: '데이터 백업 및 복원',
                backup: '백업',
                restore: '복원',
                screen: '화면',
                am: '오전',
                pm: '오후',
                localBackup: '로컬 백업',
                localRestore: '로컬 복원',
                googleBackup: '구글 백업',
                googleRestore: '구글 복원',
                exportAllData: '전체 데이터 엑셀 내보내기',
                management: '관리',
                confirmDate: '확인',
                paymentCompleteStatus: '입금 완료',
                completeStatus: '완료',
                fullTimeEmployee: '정직원',
                partTimeEmployee: '단기직원',
                resignedEmployee: '퇴사',
                vacationStatus: '휴가',
                duration30: '30분',
                duration60: '60분',
                duration90: '90분',
                duration120: '120분',
                orderZeroVacationNote: '* 순번 0은 휴가로 처리됩니다',
                selectRoomOption: '방선택',
                enterCustomerNamePlaceholder: '고객명 입력',
                menuGraphTitle: '메뉴 그래프',
                monthlyGraphTitle: '월간 그래프',
                downloadButton: '다운로드',
                staffStatisticsTitle: '직원별 통계',
                paymentMethodStatisticsTitle: '입금 방식별 통계',
                paymentMethodColumn: '입금 방식',
                amountColumn: '금액',
                dataBackupRestoreTitle: '데이터 백업 및 복원',
                backupButton: '백업',
                restoreButton: '복원',
                screenLabel: '화면',
                morningLabel: '오전',
                afternoonLabel: '오후',
                localBackupButton: '로컬 백업',
                localRestoreButton: '로컬 복원',
                googleBackupButton: '구글 백업',
                googleRestoreButton: '구글 복원',
                exportAllDataButton: '전체 데이터 엑셀 내보내기',
                managementLabel: '관리',
                // DB 관리 관련 추가 번역
                menuName: '메뉴명',
                newMenuAdd: '새 메뉴 추가',
                newStaffAdd: '새 직원 추가',
                newRoomAdd: '새 방 추가',
                newCustomerAdd: '새 고객 추가',
                newPaymentMethodAdd: '새 입금방식 추가',
                newAdminAdd: '새 관리자 추가',
                newGuaranteeAdd: '새 Guarantee 추가',
                copy: '복사',
                name: '이름',
                roomCapacity: '수용인원',
                enterRoomNumber: '방번호를 입력하세요',
                enterCapacity: '수용인원을 입력하세요',
                roomAdded: '새 방이 추가되었습니다',
                enterCustomerNamePrompt: '고객명을 입력하세요',
                enterPhonePrompt: '전화번호를 입력하세요',
                enterCustomerNumberPrompt: '고객번호를 입력하세요',
                customerAdded: '새 고객이 추가되었습니다',
                currencySettings: '화폐 단위 설정',
                currencySymbol: '화폐 기호',
                currencyName: '화폐 이름',
                currencySaved: '화폐 단위가 저장되었습니다',
                enterPaymentMethodName: '입금방식명을 입력하세요',
                paymentMethodAdded: '새 입금방식이 추가되었습니다',
                startDate: '시작일',
                endDate: '마감일',
                active: '활성',
                inactive: '비활성',
                normalAdmin: '일반관리자',
                superAdmin: '최고관리자',
                enterUsername: '아이디를 입력하세요',
                enterPassword: '비밀번호를 입력하세요',
                enterShopName: '가게명을 입력하세요',
                enterPhone: '전화번호를 입력하세요',
                adminAdded: '새 관리자가 추가되었습니다',
                menuAdded: '새 메뉴가 추가되었습니다',
                staffAdded: '새 직원이 추가되었습니다',
                guaranteeAdded: '새 Guarantee가 추가되었습니다',
                confirmDelete: '정말 삭제하시겠습니까?',
                menuCopied: '메뉴가 복사되었습니다',
                staffCopied: '직원이 복사되었습니다',
                roomCopied: '방이 복사되었습니다',
                customerCopied: '고객이 복사되었습니다',
                paymentMethodCopied: '입금방식이 복사되었습니다',
                adminCopied: '관리자가 복사되었습니다',
                guaranteeCopied: 'Guarantee가 복사되었습니다',
                enterNewPassword: '새 비밀번호를 입력하세요',
                passwordChanged: '비밀번호가 변경되었습니다',
                duplicateUsername: '이미 존재하는 아이디입니다',
                duplicateCustomerNumber: '이미 존재하는 고객번호입니다',
                duplicatePaymentMethod: '이미 존재하는 입금방식입니다',
                requiredFields: '모든 필드를 입력해주세요',
                namePhoneRequired: '이름과 전화번호는 필수입니다',
                usernamePasswordRequired: '아이디와 비밀번호는 필수입니다',
                validCapacity: '올바른 수용인원을 입력해주세요',
                amountGreaterThanZero: '금액은 0보다 커야 합니다',
                startDateBeforeEndDate: '시작일은 마감일보다 이전이어야 합니다',
                editReservation: '예약 수정',
                date: '날짜',
                dailySalesData: '일별 매출 데이터',
            },
            vi: {
                title: 'Hệ thống quản lý massage',
                changeLanguage: 'Đổi ngôn ngữ',
                changeFont: 'Đổi font chữ',
                fontSelection: 'Chọn font chữ',
                fontSize: 'Kích thước font',
                fontFamily: 'Loại font',
                fontSizeSmall: 'Nhỏ',
                fontSizeNormal: 'Bình thường',
                fontSizeLarge: 'Lớn',
                fontSizeXLarge: 'Rất lớn',
                fontSizeXXLarge: 'Tối đa',
                fontSizePreview: 'Văn bản xem trước',
                apply: 'Áp dụng',
                logout: 'Đăng xuất',
                todayDate: 'Ngày hôm nay',
                currentTime: 'Thời gian hiện tại',
                dashboard: 'Bảng điều khiển',
                order: 'Thứ tự',
                reservation: 'Đặt chỗ',
                statistics: 'Thống kê',
                dbManagement: 'Quản lý DB',
                staff: 'Nhân viên',
                menu: 'Menu',
                duration: 'Thời gian',
                startTime: 'Thời gian bắt đầu',
                endTime: 'Thời gian kết thúc',
                remainingTime: 'Thời gian còn lại',
                price: 'Giá',
                commission: 'Hoa hồng',
                roomNumber: 'Số phòng',
                actions: 'Hành động',
                selectStaff: 'Chọn nhân viên',
                selectMenu: 'Chọn menu',
                customerName: 'Tên khách hàng',
                addReservation: 'Thêm đặt chỗ',
                addMenuItem: 'Thêm Menu +',
                daily: 'Hàng ngày',
                weekly: 'Hàng tuần',
                monthly: 'Hàng tháng',
                totalPrice: 'Tổng giá',
                totalCommission: 'Tổng hoa hồng',
                grandTotal: 'Tổng cộng (trừ QR tip)',
                grandTotalCommission: 'Tổng hoa hồng',
                profit: 'Lợi nhuận',
                menuManagement: 'Quản lý menu',
                staffManagement: 'Quản lý nhân viên',
                roomManagement: 'Quản lý phòng',
                customerManagement: 'Quản lý khách hàng',
                adminManagement: 'Quản lý admin',
                currencyManagement: 'Đơn vị tiền tệ',
                paymentMethodManagement: 'Quản lý phương thức thanh toán',
                guaranteeManagement: 'Guarantee',
                payment: 'Thanh toán',
                totalAmount: 'Tổng số tiền',
                enteredAmount: 'Số tiền đã nhập',
                confirm: 'Xác nhận',
                cancel: 'Hủy',
                login: 'Đăng nhập',
                close: 'Đóng',
                edit: 'Sửa',
                delete: 'Xóa',
                add: 'Thêm',
                save: 'Lưu',
                username: 'Tên đăng nhập',
                password: 'Mật khẩu',
                usernameInput: 'Nhập tên đăng nhập',
                passwordInput: 'Nhập mật khẩu',
                staffName: 'Tên nhân viên',
                phoneNumber: 'Số điện thoại',
                bankName: 'Tên ngân hàng',
                accountNumber: 'Số tài khoản',
                status: 'Trạng thái',
                roomNum: 'Số phòng',
                customerNum: 'Số khách hàng',
                paymentMethodName: 'Tên phương thức thanh toán',
                shopName: 'Tên cửa hàng',
                adminType: 'Loại',
                orderManagement: 'Quản lý thứ tự',
                saveOrder: 'Lưu thứ tự',
                orderNumber: 'Thứ tự',
                paymentComplete: 'Thanh toán hoàn tất',
                complete: 'Hoàn tất',
                fullTime: 'Nhân viên chính thức',
                partTime: 'Nhân viên ngắn hạn',
                resigned: 'Đã nghỉ việc',
                vacation: 'Nghỉ phép',
                minutes30: '30 phút',
                minutes60: '60 phút',
                minutes90: '90 phút',
                minutes120: '120 phút',
                orderZeroNote: '* Thứ tự 0 được xử lý như nghỉ phép',
                selectRoom: 'Chọn phòng',
                enterCustomerName: 'Nhập tên khách hàng',
                monthlyMenuChart: 'Biểu đồ menu tháng',
                monthlyChart: 'Biểu đồ doanh thu tháng',
                download: 'Tải xuống',
                staffStats: 'Thống kê nhân viên',
                paymentMethodStats: 'Thống kê phương thức thanh toán',
                paymentMethod: 'Phương thức thanh toán',
                amount: 'Số tiền',
                dataBackupRestore: 'Sao lưu và khôi phục dữ liệu',
                backup: 'Sao lưu',
                restore: 'Khôi phục',
                screen: 'Màn hình',
                am: 'Sáng',
                pm: 'Chiều',
                localBackup: 'Sao lưu cục bộ',
                localRestore: 'Khôi phục cục bộ',
                googleBackup: 'Sao lưu Google',
                googleRestore: 'Khôi phục Google',
                exportAllData: 'Xuất tất cả dữ liệu Excel',
                management: 'Quản lý',
                confirmDate: 'Xác nhận',
                paymentCompleteStatus: 'Thanh toán hoàn tất',
                completeStatus: 'Hoàn tất',
                fullTimeEmployee: 'Nhân viên chính thức',
                partTimeEmployee: 'Nhân viên ngắn hạn',
                resignedEmployee: 'Đã nghỉ việc',
                vacationStatus: 'Nghỉ phép',
                duration30: '30 phút',
                duration60: '60 phút',
                duration90: '90 phút',
                duration120: '120 phút',
                orderZeroVacationNote: '* Thứ tự 0 được xử lý như nghỉ phép',
                selectRoomOption: 'Chọn phòng',
                enterCustomerNamePlaceholder: 'Nhập tên khách hàng',
                menuGraphTitle: 'Biểu đồ menu',
                monthlyGraphTitle: 'Biểu đồ tháng',
                downloadButton: 'Tải xuống',
                staffStatisticsTitle: 'Thống kê nhân viên',
                paymentMethodStatisticsTitle: 'Thống kê phương thức thanh toán',
                paymentMethodColumn: 'Phương thức thanh toán',
                amountColumn: 'Số tiền',
                dataBackupRestoreTitle: 'Sao lưu và khôi phục dữ liệu',
                backupButton: 'Sao lưu',
                restoreButton: 'Khôi phục',
                screenLabel: 'Màn hình',
                morningLabel: 'Sáng',
                afternoonLabel: 'Chiều',
                localBackupButton: 'Sao lưu cục bộ',
                localRestoreButton: 'Khôi phục cục bộ',
                googleBackupButton: 'Sao lưu Google',
                googleRestoreButton: 'Khôi phục Google',
                exportAllDataButton: 'Xuất tất cả dữ liệu Excel',
                managementLabel: 'Quản lý',
                // DB 관리 관련 추가 번역
                menuName: 'Tên menu',
                newMenuAdd: 'Thêm menu mới',
                newStaffAdd: 'Thêm nhân viên mới',
                newRoomAdd: 'Thêm phòng mới',
                newCustomerAdd: 'Thêm khách hàng mới',
                newPaymentMethodAdd: 'Thêm phương thức thanh toán mới',
                newAdminAdd: 'Thêm admin mới',
                newGuaranteeAdd: 'Thêm Guarantee mới',
                copy: 'Sao chép',
                name: 'Tên',
                roomCapacity: 'Sức chứa',
                enterRoomNumber: 'Nhập số phòng',
                enterCapacity: 'Nhập sức chứa',
                roomAdded: 'Phòng mới đã được thêm',
                enterCustomerNamePrompt: 'Nhập tên khách hàng',
                enterPhonePrompt: 'Nhập số điện thoại',
                enterCustomerNumberPrompt: 'Nhập số khách hàng',
                customerAdded: 'Khách hàng mới đã được thêm',
                currencySettings: 'Cài đặt đơn vị tiền tệ',
                currencySymbol: 'Ký hiệu tiền tệ',
                currencyName: 'Tên tiền tệ',
                currencySaved: 'Đơn vị tiền tệ đã được lưu',
                enterPaymentMethodName: 'Nhập tên phương thức thanh toán',
                paymentMethodAdded: 'Phương thức thanh toán mới đã được thêm',
                startDate: 'Ngày bắt đầu',
                endDate: 'Ngày kết thúc',
                active: 'Hoạt động',
                inactive: 'Không hoạt động',
                normalAdmin: 'Admin thường',
                superAdmin: 'Super Admin',
                enterUsername: 'Nhập tên đăng nhập',
                enterPassword: 'Nhập mật khẩu',
                enterShopName: 'Nhập tên cửa hàng',
                enterPhone: 'Nhập số điện thoại',
                adminAdded: 'Admin mới đã được thêm',
                menuAdded: 'Menu mới đã được thêm',
                staffAdded: 'Nhân viên mới đã được thêm',
                guaranteeAdded: 'Guarantee mới đã được thêm',
                confirmDelete: 'Bạn có chắc chắn muốn xóa?',
                menuCopied: 'Menu đã được sao chép',
                staffCopied: 'Nhân viên đã được sao chép',
                roomCopied: 'Phòng đã được sao chép',
                customerCopied: 'Khách hàng đã được sao chép',
                paymentMethodCopied: 'Phương thức thanh toán đã được sao chép',
                adminCopied: 'Admin đã được sao chép',
                guaranteeCopied: 'Guarantee đã được sao chép',
                enterNewPassword: 'Nhập mật khẩu mới',
                passwordChanged: 'Mật khẩu đã được thay đổi',
                duplicateUsername: 'Tên đăng nhập đã tồn tại',
                duplicateCustomerNumber: 'Số khách hàng đã tồn tại',
                duplicatePaymentMethod: 'Phương thức thanh toán đã tồn tại',
                requiredFields: 'Vui lòng nhập tất cả các trường',
                namePhoneRequired: 'Tên và số điện thoại là bắt buộc',
                usernamePasswordRequired: 'Tên đăng nhập và mật khẩu là bắt buộc',
                validCapacity: 'Vui lòng nhập sức chứa hợp lệ',
                amountGreaterThanZero: 'Số tiền phải lớn hơn 0',
                startDateBeforeEndDate: 'Ngày bắt đầu phải trước ngày kết thúc',
                editReservation: 'Sửa đặt chỗ',
                date: 'Ngày',
                dailySalesData: 'Dữ liệu bán hàng hàng ngày',
            },
            en: {
                title: 'Massage Management System',
                changeLanguage: 'Change Language',
                changeFont: 'Change Font',
                fontSelection: 'Font Selection',
                fontSize: 'Font Size',
                fontFamily: 'Font Family',
                fontSizeSmall: 'Small',
                fontSizeNormal: 'Normal',
                fontSizeLarge: 'Large',
                fontSizeXLarge: 'Extra Large',
                fontSizeXXLarge: 'Maximum',
                fontSizePreview: 'Preview Text',
                apply: 'Apply',
                logout: 'Logout',
                todayDate: 'Today\'s Date',
                currentTime: 'Current Time',
                dashboard: 'Dashboard',
                order: 'Order',
                reservation: 'Reservation',
                statistics: 'Statistics',
                dbManagement: 'DB Management',
                staff: 'Staff',
                menu: 'Menu',
                duration: 'Duration',
                startTime: 'Start Time',
                endTime: 'End Time',
                remainingTime: 'Remaining Time',
                price: 'Price',
                commission: 'Commission',
                roomNumber: 'Room Number',
                actions: 'Actions',
                selectStaff: 'Select Staff',
                selectMenu: 'Select Menu',
                customerName: 'Customer Name',
                addReservation: 'Add Reservation',
                addMenuItem: 'Menu +',
                daily: 'Daily',
                weekly: 'Weekly',
                monthly: 'Monthly',
                totalPrice: 'Total Price',
                totalCommission: 'Total Commission',
                grandTotal: 'Grand Total (excl. QR tip)',
                grandTotalCommission: 'Grand Total Commission',
                profit: 'Profit',
                menuManagement: 'Menu Management',
                staffManagement: 'Staff Management',
                roomManagement: 'Room Management',
                customerManagement: 'Customer Management',
                adminManagement: 'Admin Management',
                currencyManagement: 'Currency Unit',
                paymentMethodManagement: 'Payment Method Management',
                guaranteeManagement: 'Guarantee',
                payment: 'Payment Processing',
                totalAmount: 'Total Amount',
                enteredAmount: 'Entered Amount',
                confirm: 'Confirm',
                cancel: 'Cancel',
                login: 'Login',
                close: 'Close',
                edit: 'Edit',
                delete: 'Delete',
                add: 'Add',
                save: 'Save',
                username: 'Username',
                password: 'Password',
                usernameInput: 'Enter username',
                passwordInput: 'Enter password',
                staffName: 'Staff Name',
                phoneNumber: 'Phone Number',
                bankName: 'Bank Name',
                accountNumber: 'Account Number',
                status: 'Status',
                roomNum: 'Room Number',
                customerNum: 'Customer Number',
                paymentMethodName: 'Payment Method Name',
                shopName: 'Shop Name',
                adminType: 'Type',
                orderManagement: 'Order Management',
                saveOrder: 'Save Order',
                orderNumber: 'Order',
                paymentComplete: 'Payment Complete',
                complete: 'Complete',
                fullTime: 'Full-time',
                partTime: 'Part-time',
                resigned: 'Resigned',
                vacation: 'Vacation',
                minutes30: '30 minutes',
                minutes60: '60 minutes',
                minutes90: '90 minutes',
                minutes120: '120 minutes',
                orderZeroNote: '* Order 0 is treated as vacation',
                selectRoom: 'Select Room',
                enterCustomerName: 'Enter customer name',
                monthlyMenuChart: 'Monthly Menu Chart',
                monthlyChart: 'Monthly Sales Chart',
                download: 'Download',
                staffStats: 'Staff Statistics',
                paymentMethodStats: 'Payment Method Statistics',
                paymentMethod: 'Payment Method',
                amount: 'Amount',
                dataBackupRestore: 'Data Backup and Restore',
                backup: 'Backup',
                restore: 'Restore',
                screen: 'Screen',
                am: 'AM',
                pm: 'PM',
                localBackup: 'Local Backup',
                localRestore: 'Local Restore',
                googleBackup: 'Google Backup',
                googleRestore: 'Google Restore',
                exportAllData: 'Export All Data to Excel',
                management: 'Management',
                confirmDate: 'Confirm',
                paymentCompleteStatus: 'Payment Complete',
                completeStatus: 'Complete',
                fullTimeEmployee: 'Full-time',
                partTimeEmployee: 'Part-time',
                resignedEmployee: 'Resigned',
                vacationStatus: 'Vacation',
                duration30: '30 minutes',
                duration60: '60 minutes',
                duration90: '90 minutes',
                duration120: '120 minutes',
                orderZeroVacationNote: '* Order 0 is treated as vacation',
                selectRoomOption: 'Select Room',
                enterCustomerNamePlaceholder: 'Enter customer name',
                menuGraphTitle: 'Menu Chart',
                monthlyGraphTitle: 'Monthly Chart',
                downloadButton: 'Download',
                staffStatisticsTitle: 'Staff Statistics',
                paymentMethodStatisticsTitle: 'Payment Method Statistics',
                paymentMethodColumn: 'Payment Method',
                amountColumn: 'Amount',
                dataBackupRestoreTitle: 'Data Backup and Restore',
                backupButton: 'Backup',
                restoreButton: 'Restore',
                screenLabel: 'Screen',
                morningLabel: 'AM',
                afternoonLabel: 'PM',
                localBackupButton: 'Local Backup',
                localRestoreButton: 'Local Restore',
                googleBackupButton: 'Google Backup',
                googleRestoreButton: 'Google Restore',
                exportAllDataButton: 'Export All Data to Excel',
                managementLabel: 'Management',
                // DB 관리 관련 추가 번역
                menuName: 'Menu Name',
                newMenuAdd: 'Add New Menu',
                newStaffAdd: 'Add New Staff',
                newRoomAdd: 'Add New Room',
                newCustomerAdd: 'Add New Customer',
                newPaymentMethodAdd: 'Add New Payment Method',
                newAdminAdd: 'Add New Admin',
                newGuaranteeAdd: 'Add New Guarantee',
                copy: 'Copy',
                name: 'Name',
                roomCapacity: 'Capacity',
                enterRoomNumber: 'Enter room number',
                enterCapacity: 'Enter capacity',
                roomAdded: 'New room has been added',
                enterCustomerNamePrompt: 'Enter customer name',
                enterPhonePrompt: 'Enter phone number',
                enterCustomerNumberPrompt: 'Enter customer number',
                customerAdded: 'New customer has been added',
                currencySettings: 'Currency Settings',
                currencySymbol: 'Currency Symbol',
                currencyName: 'Currency Name',
                currencySaved: 'Currency unit has been saved',
                enterPaymentMethodName: 'Enter payment method name',
                paymentMethodAdded: 'New payment method has been added',
                startDate: 'Start Date',
                endDate: 'End Date',
                active: 'Active',
                inactive: 'Inactive',
                normalAdmin: 'Normal Admin',
                superAdmin: 'Super Admin',
                enterUsername: 'Enter username',
                enterPassword: 'Enter password',
                enterShopName: 'Enter shop name',
                enterPhone: 'Enter phone number',
                adminAdded: 'New admin has been added',
                menuAdded: 'New menu has been added',
                staffAdded: 'New staff has been added',
                guaranteeAdded: 'New guarantee has been added',
                confirmDelete: 'Are you sure you want to delete?',
                menuCopied: 'Menu has been copied',
                staffCopied: 'Staff has been copied',
                roomCopied: 'Room has been copied',
                customerCopied: 'Customer has been copied',
                paymentMethodCopied: 'Payment method has been copied',
                adminCopied: 'Admin has been copied',
                guaranteeCopied: 'Guarantee has been copied',
                enterNewPassword: 'Enter new password',
                passwordChanged: 'Password has been changed',
                duplicateUsername: 'Username already exists',
                duplicateCustomerNumber: 'Customer number already exists',
                duplicatePaymentMethod: 'Payment method already exists',
                requiredFields: 'Please fill in all fields',
                namePhoneRequired: 'Name and phone number are required',
                usernamePasswordRequired: 'Username and password are required',
                validCapacity: 'Please enter a valid capacity',
                amountGreaterThanZero: 'Amount must be greater than 0',
                startDateBeforeEndDate: 'Start date must be before end date',
                editReservation: 'Edit Reservation',
                date: 'Date',
                dailySalesData: 'Daily Sales Data',
            },
            th: {
                title: 'ระบบจัดการนวดแผนไทย',
                changeLanguage: 'เปลี่ยนภาษา',
                changeFont: 'เปลี่ยนฟอนต์',
                fontSelection: 'เลือกฟอนต์',
                fontSize: 'ขนาดฟอนต์',
                fontFamily: 'ประเภทฟอนต์',
                fontSizeSmall: 'เล็ก',
                fontSizeNormal: 'ปกติ',
                fontSizeLarge: 'ใหญ่',
                fontSizeXLarge: 'ใหญ่มาก',
                fontSizeXXLarge: 'ใหญ่ที่สุด',
                fontSizePreview: 'ตัวอย่างข้อความ',
                apply: 'ใช้งาน',
                logout: 'ออกจากระบบ',
                todayDate: 'วันที่วันนี้',
                currentTime: 'เวลาปัจจุบัน',
                dashboard: 'แดชบอร์ด',
                order: 'ลำดับ',
                reservation: 'การจอง',
                statistics: 'สถิติ',
                dbManagement: 'จัดการฐานข้อมูล',
                staff: 'พนักงาน',
                menu: 'เมนู',
                duration: 'ระยะเวลา',
                startTime: 'เวลาเริ่ม',
                endTime: 'เวลาสิ้นสุด',
                remainingTime: 'เวลาที่เหลือ',
                price: 'ราคา',
                commission: 'คอมมิชชั่น',
                roomNumber: 'หมายเลขห้อง',
                actions: 'การดำเนินการ',
                selectStaff: 'เลือกพนักงาน',
                selectMenu: 'เลือกเมนู',
                customerName: 'ชื่อลูกค้า',
                addReservation: 'เพิ่มการจอง',
                addMenuItem: 'เพิ่มเมนู +',
                daily: 'รายวัน',
                weekly: 'รายสัปดาห์',
                monthly: 'รายเดือน',
                totalPrice: 'ราคารวม',
                totalCommission: 'คอมมิชชั่นรวม',
                grandTotal: 'ยอดรวมทั้งหมด (ไม่รวม QR tip)',
                grandTotalCommission: 'คอมมิชชั่นรวมทั้งหมด',
                profit: 'กำไร',
                menuManagement: 'จัดการเมนู',
                staffManagement: 'จัดการพนักงาน',
                roomManagement: 'จัดการห้อง',
                customerManagement: 'จัดการลูกค้า',
                adminManagement: 'จัดการผู้ดูแล',
                currencyManagement: 'หน่วยเงินตรา',
                paymentMethodManagement: 'จัดการวิธีการชำระเงิน',
                guaranteeManagement: 'Guarantee',
                payment: 'การชำระเงิน',
                totalAmount: 'จำนวนเงินรวม',
                enteredAmount: 'จำนวนเงินที่ป้อน',
                confirm: 'ยืนยัน',
                cancel: 'ยกเลิก',
                login: 'เข้าสู่ระบบ',
                close: 'ปิด',
                edit: 'แก้ไข',
                delete: 'ลบ',
                add: 'เพิ่ม',
                save: 'บันทึก',
                username: 'ชื่อผู้ใช้',
                password: 'รหัสผ่าน',
                usernameInput: 'กรอกชื่อผู้ใช้',
                passwordInput: 'กรอกรหัสผ่าน',
                staffName: 'ชื่อพนักงาน',
                phoneNumber: 'หมายเลขโทรศัพท์',
                bankName: 'ชื่อธนาคาร',
                accountNumber: 'หมายเลขบัญชี',
                status: 'สถานะ',
                roomNum: 'หมายเลขห้อง',
                customerNum: 'หมายเลขลูกค้า',
                paymentMethodName: 'ชื่อวิธีการชำระเงิน',
                shopName: 'ชื่อร้าน',
                adminType: 'ประเภท',
                orderManagement: 'จัดการลำดับ',
                saveOrder: 'บันทึกลำดับ',
                orderNumber: 'ลำดับ',
                paymentComplete: 'ชำระเงินเสร็จสิ้น',
                complete: 'เสร็จสิ้น',
                fullTime: 'พนักงานประจำ',
                partTime: 'พนักงานชั่วคราว',
                resigned: 'ลาออก',
                vacation: 'ลาพักร้อน',
                minutes30: '30 นาที',
                minutes60: '60 นาที',
                minutes90: '90 นาที',
                minutes120: '120 นาที',
                orderZeroNote: '* ลำดับ 0 จะถือเป็นลาพักร้อน',
                selectRoom: 'เลือกห้อง',
                enterCustomerName: 'กรอกชื่อลูกค้า',
                monthlyMenuChart: 'กราฟเมนูรายเดือน',
                monthlyChart: 'กราฟยอดขายรายเดือน',
                download: 'ดาวน์โหลด',
                staffStats: 'สถิติพนักงาน',
                paymentMethodStats: 'สถิติวิธีการชำระเงิน',
                paymentMethod: 'วิธีการชำระเงิน',
                amount: 'จำนวนเงิน',
                dataBackupRestore: 'สำรองและกู้คืนข้อมูล',
                backup: 'สำรอง',
                restore: 'กู้คืน',
                screen: 'หน้าจอ',
                am: 'ก่อนเที่ยง',
                pm: 'หลังเที่ยง',
                localBackup: 'สำรองข้อมูลในเครื่อง',
                localRestore: 'กู้คืนข้อมูลในเครื่อง',
                googleBackup: 'สำรองข้อมูล Google',
                googleRestore: 'กู้คืนข้อมูล Google',
                exportAllData: 'ส่งออกข้อมูลทั้งหมดเป็น Excel',
                management: 'จัดการ',
                confirmDate: 'ยืนยัน',
                paymentCompleteStatus: 'ชำระเงินเสร็จสิ้น',
                completeStatus: 'เสร็จสิ้น',
                fullTimeEmployee: 'พนักงานประจำ',
                partTimeEmployee: 'พนักงานชั่วคราว',
                resignedEmployee: 'ลาออก',
                vacationStatus: 'ลาพักร้อน',
                duration30: '30 นาที',
                duration60: '60 นาที',
                duration90: '90 นาที',
                duration120: '120 นาที',
                orderZeroVacationNote: '* ลำดับ 0 จะถือเป็นลาพักร้อน',
                selectRoomOption: 'เลือกห้อง',
                enterCustomerNamePlaceholder: 'กรอกชื่อลูกค้า',
                menuGraphTitle: 'กราฟเมนู',
                monthlyGraphTitle: 'กราฟรายเดือน',
                downloadButton: 'ดาวน์โหลด',
                staffStatisticsTitle: 'สถิติพนักงาน',
                paymentMethodStatisticsTitle: 'สถิติวิธีการชำระเงิน',
                paymentMethodColumn: 'วิธีการชำระเงิน',
                amountColumn: 'จำนวนเงิน',
                dataBackupRestoreTitle: 'สำรองและกู้คืนข้อมูล',
                backupButton: 'สำรอง',
                restoreButton: 'กู้คืน',
                screenLabel: 'หน้าจอ',
                morningLabel: 'ก่อนเที่ยง',
                afternoonLabel: 'หลังเที่ยง',
                localBackupButton: 'สำรองข้อมูลในเครื่อง',
                localRestoreButton: 'กู้คืนข้อมูลในเครื่อง',
                googleBackupButton: 'สำรองข้อมูล Google',
                googleRestoreButton: 'กู้คืนข้อมูล Google',
                exportAllDataButton: 'ส่งออกข้อมูลทั้งหมดเป็น Excel',
                managementLabel: 'จัดการ',
                // DB 관리 관련 추가 번역
                menuName: 'ชื่อเมนู',
                newMenuAdd: 'เพิ่มเมนูใหม่',
                newStaffAdd: 'เพิ่มพนักงานใหม่',
                newRoomAdd: 'เพิ่มห้องใหม่',
                newCustomerAdd: 'เพิ่มลูกค้าใหม่',
                newPaymentMethodAdd: 'เพิ่มวิธีการชำระเงินใหม่',
                newAdminAdd: 'เพิ่มผู้ดูแลใหม่',
                newGuaranteeAdd: 'เพิ่ม Guarantee ใหม่',
                copy: 'คัดลอก',
                name: 'ชื่อ',
                roomCapacity: 'ความจุ',
                enterRoomNumber: 'กรอกหมายเลขห้อง',
                enterCapacity: 'กรอกความจุ',
                roomAdded: 'เพิ่มห้องใหม่แล้ว',
                enterCustomerNamePrompt: 'กรอกชื่อลูกค้า',
                enterPhonePrompt: 'กรอกหมายเลขโทรศัพท์',
                enterCustomerNumberPrompt: 'กรอกหมายเลขลูกค้า',
                customerAdded: 'เพิ่มลูกค้าใหม่แล้ว',
                currencySettings: 'ตั้งค่าหน่วยเงินตรา',
                currencySymbol: 'สัญลักษณ์เงินตรา',
                currencyName: 'ชื่อเงินตรา',
                currencySaved: 'บันทึกหน่วยเงินตราแล้ว',
                enterPaymentMethodName: 'กรอกชื่อวิธีการชำระเงิน',
                paymentMethodAdded: 'เพิ่มวิธีการชำระเงินใหม่แล้ว',
                startDate: 'วันที่เริ่ม',
                endDate: 'วันที่สิ้นสุด',
                active: 'ใช้งาน',
                inactive: 'ไม่ใช้งาน',
                normalAdmin: 'ผู้ดูแลทั่วไป',
                superAdmin: 'ผู้ดูแลสูงสุด',
                enterUsername: 'กรอกชื่อผู้ใช้',
                enterPassword: 'กรอกรหัสผ่าน',
                enterShopName: 'กรอกชื่อร้าน',
                enterPhone: 'กรอกหมายเลขโทรศัพท์',
                adminAdded: 'เพิ่มผู้ดูแลใหม่แล้ว',
                menuAdded: 'เพิ่มเมนูใหม่แล้ว',
                staffAdded: 'เพิ่มพนักงานใหม่แล้ว',
                guaranteeAdded: 'เพิ่ม Guarantee ใหม่แล้ว',
                confirmDelete: 'คุณแน่ใจหรือไม่ที่จะลบ?',
                menuCopied: 'คัดลอกเมนูแล้ว',
                staffCopied: 'คัดลอกพนักงานแล้ว',
                roomCopied: 'คัดลอกห้องแล้ว',
                customerCopied: 'คัดลอกลูกค้าแล้ว',
                paymentMethodCopied: 'คัดลอกวิธีการชำระเงินแล้ว',
                adminCopied: 'คัดลอกผู้ดูแลแล้ว',
                guaranteeCopied: 'คัดลอก Guarantee แล้ว',
                enterNewPassword: 'กรอกรหัสผ่านใหม่',
                passwordChanged: 'เปลี่ยนรหัสผ่านแล้ว',
                duplicateUsername: 'ชื่อผู้ใช้นี้มีอยู่แล้ว',
                duplicateCustomerNumber: 'หมายเลขลูกค้านี้มีอยู่แล้ว',
                duplicatePaymentMethod: 'วิธีการชำระเงินนี้มีอยู่แล้ว',
                requiredFields: 'กรุณากรอกข้อมูลให้ครบทุกช่อง',
                namePhoneRequired: 'ชื่อและหมายเลขโทรศัพท์จำเป็นต้องกรอก',
                usernamePasswordRequired: 'ชื่อผู้ใช้และรหัสผ่านจำเป็นต้องกรอก',
                validCapacity: 'กรุณากรอกความจุที่ถูกต้อง',
                amountGreaterThanZero: 'จำนวนเงินต้องมากกว่า 0',
                startDateBeforeEndDate: 'วันที่เริ่มต้องมาก่อนวันที่สิ้นสุด',
                editReservation: 'แก้ไขการจอง',
                date: 'วันที่',
                dailySalesData: 'ข้อมูลการขายรายวัน',
            }
        };

        // 초기화
        function initializeApp() {
            initializeGlobalData();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            document.getElementById('currentDate').value = new Date().toISOString().split('T')[0];
            
            // 저장된 폰트 설정 복원
            const savedFont = localStorage.getItem('selectedFont');
            const savedFontSize = localStorage.getItem('selectedFontSize');
            if (savedFont) {
                currentFont = savedFont;
                selectedFontFamily = savedFont;
            }
            if (savedFontSize) {
                currentFontSize = savedFontSize;
                selectedFontSize = savedFontSize;
            }
            applyFontSettings();
            
            // 새로고침시 로그인 상태 복원
            const savedAdmin = localStorage.getItem('currentAdmin');
            if (savedAdmin) {
                currentAdmin = JSON.parse(savedAdmin);
                initializeAdminData();
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainScreen').style.display = 'block';
                
                // 상점명 설정
                const shopNameElement = document.getElementById('shopName');
                if (currentAdmin.type === 'super') {
                    shopNameElement.textContent = '최고 관리자 화면';
                    document.getElementById('superAdminButtons').style.display = 'block';
                } else {
                    shopNameElement.textContent = currentAdmin.shopName;
                    document.getElementById('superAdminButtons').style.display = 'none';
                }
                
                loadReservationData();
                showDashboard();
            }
        }

        // 전역 데이터 초기화 (관리자 계정만)
        function initializeGlobalData() {
            if (!localStorage.getItem('globalAdmins')) {
                localStorage.setItem('globalAdmins', JSON.stringify([
                    {id: 1, username: 'admin', password: '12345678', type: 'super', shopName: '', phone: ''},
                    {id: 2, username: 'shop1', password: '12345678', type: 'normal', shopName: '힐링 마사지', phone: '02-1234-5678'},
                    {id: 3, username: 'Test', password: '1111', type: 'normal', shopName: '테스트 마사지', phone: '02-0000-0000'}
                ]));
            }

            if (!localStorage.getItem('globalCurrency')) {
                localStorage.setItem('globalCurrency', JSON.stringify({
                    symbol: '',
                    name: '원'
                }));
            }
        }

        // 관리자별 데이터베이스 키 생성
        function getAdminKey(dataType) {
            return `${currentAdmin.username}_${dataType}`;
        }

        // 관리자별 데이터 초기화
        function initializeAdminData() {
            const adminPrefix = currentAdmin.username;

            // 기본 데이터 설정
            if (!localStorage.getItem(getAdminKey('menus'))) {
                localStorage.setItem(getAdminKey('menus'), JSON.stringify([
                    {
                        id: 1, 
                        name: '타이 마사지',
                        prices: {
                            30: {price: 30000, commission: 15000},
                            60: {price: 50000, commission: 25000},
                            90: {price: 70000, commission: 35000},
                            120: {price: 90000, commission: 45000}
                        }
                    },
                    {
                        id: 2, 
                        name: '오일 마사지',
                        prices: {
                            60: {price: 80000, commission: 40000},
                            90: {price: 110000, commission: 55000},
                            120: {price: 140000, commission: 70000}
                        }
                    }
                ]));
            }

            if (!localStorage.getItem(getAdminKey('staff'))) {
                localStorage.setItem(getAdminKey('staff'), JSON.stringify([
                    {id: 1, name: '김미영', phone: '010-1234-5678', bank: '국민은행', account: '123-456-789', status: '정직원'},
                    {id: 2, name: '이수진', phone: '010-9876-5432', bank: '신한은행', account: '987-654-321', status: '정직원'}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('staffOrder'))) {
                localStorage.setItem(getAdminKey('staffOrder'), JSON.stringify({}));
            }

            if (!localStorage.getItem(getAdminKey('rooms'))) {
                localStorage.setItem(getAdminKey('rooms'), JSON.stringify([
                    {id: 1, roomNumber: '101', capacity: 1},
                    {id: 2, roomNumber: '102', capacity: 2},
                    {id: 3, roomNumber: '103', capacity: 1}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('customers'))) {
                localStorage.setItem(getAdminKey('customers'), JSON.stringify([
                    {id: 1, name: '홍길동', phone: '010-1111-2222', customerNumber: '100001'},
                    {id: 2, name: '김철수', phone: '010-3333-4444', customerNumber: '100002'}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('paymentMethods'))) {
                localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify([
                    {id: 1, name: '현금'},
                    {id: 2, name: 'QR'},
                    {id: 3, name: '쿠폰'},
                    {id: 4, name: 'QR TIP'},
                    {id: 5, name: '기타'}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('reservations'))) {
                localStorage.setItem(getAdminKey('reservations'), JSON.stringify([]));
            }

            if (!localStorage.getItem(getAdminKey('currency'))) {
                const globalCurrency = JSON.parse(localStorage.getItem('globalCurrency'));
                localStorage.setItem(getAdminKey('currency'), JSON.stringify(globalCurrency));
            }

            if (!localStorage.getItem(getAdminKey('guarantees'))) {
                localStorage.setItem(getAdminKey('guarantees'), JSON.stringify([]));
            }
        }

        // 로그인 처리
        function processLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('아이디와 비밀번호를 입력해주세요.');
                return;
            }

            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.username === username && a.password === password);
            
            if (admin) {
                currentAdmin = admin;
                localStorage.setItem('currentAdmin', JSON.stringify(admin));
                initializeAdminData();
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainScreen').style.display = 'block';
                
                // 상점명 설정
                const shopNameElement = document.getElementById('shopName');
                if (admin.type === 'super') {
                    shopNameElement.textContent = '최고 관리자 화면';
                    document.getElementById('superAdminButtons').style.display = 'block';
                } else {
                    shopNameElement.textContent = admin.shopName;
                    document.getElementById('superAdminButtons').style.display = 'none';
                }
                
                loadReservationData();
                showDashboard();
            } else {
                alert('아이디 또는 비밀번호가 잘못되었습니다.');
            }
        }

        // 로그아웃
        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                currentAdmin = null;
                localStorage.removeItem('currentAdmin');
                selectedStaff = null;
                selectedMenu = null;
                selectedDuration = null;
                pendingReservationItems = [];
                document.getElementById('mainScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                
                // 모든 섹션 숨기기
                hideAllSections();
                
                // 언어를 한국어로 초기화
                setLanguage('ko');
            }
        }

        // 언어 설정
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // 언어 버튼 스타일 업데이트
            document.getElementById('langKo').className = lang === 'ko' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            document.getElementById('langEn').className = lang === 'en' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            document.getElementById('langTh').className = lang === 'th' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            document.getElementById('langVi').className = lang === 'vi' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            
            updateTranslations();
            
            // 메인 화면이 표시된 경우에만 데이터 로드
            if (document.getElementById('mainScreen').style.display === 'block') {
                loadReservationData();
                // 현재 열려있는 섹션을 다시 로드
                if (document.getElementById('dashboardSection').style.display === 'block') showDashboard();
                if (document.getElementById('orderSection').style.display === 'block') showOrder();
                if (document.getElementById('reservationSection').style.display === 'block') showReservation();
                if (document.getElementById('statisticsSection').style.display === 'block') showStatistics();
            }
        }

        function updateTranslations() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    if (element.tagName === 'INPUT' && (element.type === 'text' || element.type === 'password')) {
                        element.placeholder = translations[currentLanguage][key];
                    } else {
                        element.textContent = translations[currentLanguage][key];
                    }
                }
            });
            
            // placeholder 전용 번역 처리
            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
            
            updateCurrencyDisplay();
        }

        // 화폐 단위 표시 업데이트
        function updateCurrencyDisplay() {
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            const currencyElements = document.querySelectorAll('[id$="Currency"]');
            currencyElements.forEach(element => {
                element.textContent = currency.symbol;
            });
        }

        // 시간 업데이트
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
            updateDashboardRemainingTime();
        }

        function updateCurrentDate() {
            loadReservationData();
        }

        function confirmDateChange() {
            loadReservationData();
            if (document.getElementById('dashboardSection').style.display === 'block') {
                loadDashboard();
            }
            if (document.getElementById('statisticsSection').style.display === 'block') {
                document.getElementById('statsDate').value = document.getElementById('currentDate').value;
                updateStats();
            }
        }

        // 섹션 표시/숨김
        function hideAllSections() {
            const sections = ['dashboardSection', 'orderSection', 'reservationSection', 'statisticsSection', 'dbManagementSection'];
            sections.forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
        }

        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboardSection').style.display = 'block';
            loadDashboard();
        }

        function showReservation() {
            hideAllSections();
            document.getElementById('reservationSection').style.display = 'block';
            loadReservationData();
        }

        function showStatistics() {
            hideAllSections();
            document.getElementById('statisticsSection').style.display = 'block';
            document.getElementById('statsDate').value = document.getElementById('currentDate').value;
            showDailyStats();
        }

        function showOrder() {
            hideAllSections();
            document.getElementById('orderSection').style.display = 'block';
            loadStaffOrder();
        }

        function showDBManagement() {
            hideAllSections();
            document.getElementById('dbManagementSection').style.display = 'block';
        }

        // 현황판 관련 함수
        function loadDashboard() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const staffOrder = JSON.parse(localStorage.getItem(getAdminKey('staffOrder')) || '{}');
            const currentDate = document.getElementById('currentDate').value;
            const todayReservations = reservations.filter(r => r.date === currentDate);
            
            // 순번 순서로 정렬
            todayReservations.sort((a, b) => {
                const orderA = staffOrder[a.staffId] || 999;
                const orderB = staffOrder[b.staffId] || 999;
                return orderA - orderB;
            });
            
            const tableBody = document.getElementById('dashboardTable');
            tableBody.innerHTML = '';

            todayReservations.forEach(reservation => {
                const row = document.createElement('tr');
                const endTime = calculateEndTime(reservation.startTime, reservation.duration);
                const remainingMinutes = calculateRemainingTime(reservation.startTime, reservation.duration);
                
                if (reservation.paid) {
                    row.className = 'bg-green-50';
                }
                
                const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
                
                const staffOrderNum = staffOrder[reservation.staffId] !== undefined ? staffOrder[reservation.staffId] : 1;
                const vacationText = translations[currentLanguage].vacationStatus || '휴가';
                const staffDisplayName = staffOrderNum === 0 ? `${reservation.staffName} (${vacationText})` : `${staffOrderNum}. ${reservation.staffName}`;
                
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${staffDisplayName}</td>
                    <td class="border border-gray-300 p-2">${reservation.menuName}</td>
                    <td class="border border-gray-300 p-2">${reservation.duration}min</td>
                    <td class="border border-gray-300 p-2">${reservation.startTime || '-'}</td>
                    <td class="border border-gray-300 p-2">${reservation.startTime ? endTime : '-'}</td>
                    <td class="border border-gray-300 p-2 remaining-time">${reservation.paid ? '-' : (reservation.startTime ? remainingMinutes + 'min' : '-')}</td>
                    <td class="border border-gray-300 p-2">${reservation.price.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${reservation.commission.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${reservation.roomNumber || '-'}</td>
                    <td class="border border-gray-300 p-2">
                        ${reservation.paid ? 
                            `<span class="bg-green-500 text-white px-3 py-1 rounded text-sm font-bold">${translations[currentLanguage].paymentCompleteStatus || '입금 완료'}</span>` :
                            `<button onclick="editReservation(${reservation.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].edit || '수정'}</button>
                             <button onclick="showPaymentModal(${reservation.id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].payment || '입금'}</button>
                             <button onclick="deleteReservation(${reservation.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].delete || '삭제'}</button>`
                        }
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function calculateEndTime(startTime, duration) {
            if (!startTime) return '-';
            const [hours, minutes] = startTime.split(':').map(Number);
            const startMinutes = hours * 60 + minutes;
            const endMinutes = startMinutes + duration;
            const endHours = Math.floor(endMinutes / 60);
            const endMins = endMinutes % 60;
            return `${endHours.toString().padStart(2, '0')}:${endMins.toString().padStart(2, '0')}`;
        }

        function calculateRemainingTime(startTime, duration) {
            if (!startTime) return 0;
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            
            const [hours, minutes] = startTime.split(':').map(Number);
            const startMinutes = hours * 60 + minutes;
            const endMinutes = startMinutes + duration;
            
            return Math.max(0, endMinutes - currentMinutes);
        }

        function updateDashboardRemainingTime() {
            const remainingCells = document.querySelectorAll('.remaining-time');
            remainingCells.forEach((cell, index) => {
                const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
                const currentDate = document.getElementById('currentDate').value;
                const todayReservations = reservations.filter(r => r.date === currentDate)
                    .sort((a, b) => {
                        const staffOrder = JSON.parse(localStorage.getItem(getAdminKey('staffOrder')) || '{}');
                        const orderA = staffOrder[a.staffId] || 999;
                        const orderB = staffOrder[b.staffId] || 999;
                        return orderA - orderB;
                    });

                if (todayReservations[index]) {
                    const reservation = todayReservations[index];
                    
                    if (reservation.paid) {
                        cell.textContent = '-';
                        cell.style.color = '#10b981';
                        cell.style.fontWeight = 'bold';
                    } else if (reservation.startTime) {
                        const remaining = calculateRemainingTime(reservation.startTime, reservation.duration);
                        cell.textContent = `${remaining}min`;
                        
                        if (remaining <= 10) {
                            cell.style.color = '#ef4444';
                        } else if (remaining <= 30) {
                            cell.style.color = '#f59e0b';
                        } else {
                            cell.style.color = '#10b981';
                        }
                    } else {
                        cell.textContent = '-';
                        cell.style.color = '#6b7280';
                    }
                }
            });
        }

        // 예약 관련 함수
        function loadReservationData() {
            loadStaffSelection();
            loadMenuSelection();
            loadRoomSelection();
            updateReservationDetails();
            document.getElementById('multiMenuSection').classList.add('hidden');
        }

        function loadStaffSelection() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const staffOrder = JSON.parse(localStorage.getItem(getAdminKey('staffOrder')) || '{}');
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const currentDate = document.getElementById('currentDate').value;
            
            const activeStaff = staff.filter(s => (s.status || '정직원') !== '퇴사');
            
            activeStaff.sort((a, b) => {
                const orderA = staffOrder[a.id] !== undefined ? staffOrder[a.id] : 1;
                const orderB = staffOrder[b.id] !== undefined ? staffOrder[b.id] : 1;
                if (orderA === 0 && orderB !== 0) return 1;
                if (orderA !== 0 && orderB === 0) return -1;
                if (orderA === 0 && orderB === 0) return 0;
                return orderA - orderB;
            });
            
            const container = document.getElementById('staffSelection');
            container.innerHTML = '';

            activeStaff.forEach(s => {
                const order = staffOrder[s.id] !== undefined ? staffOrder[s.id] : 1;
                const isOnVacation = order === 0;
                const hasReservation = reservations.some(r => 
                    r.date === currentDate && 
                    r.staffId === s.id && 
                    !r.paid && 
                    r.startTime
                );
                
                const div = document.createElement('div');
                div.className = 'selection-item';
                div.setAttribute('data-staff-id', s.id);
                
                if (hasReservation || isOnVacation) {
                    div.style.backgroundColor = '#9ca3af';
                    div.style.color = 'white';
                    div.style.cursor = 'not-allowed';
                }
                
                const vacationText = translations[currentLanguage].vacationStatus || '휴가';
                div.textContent = `${s.name} (${order === 0 ? vacationText : order})`;
                
                if (!hasReservation && !isOnVacation) {
                    div.onclick = () => selectStaff(s.id, s.name, div);
                }
                
                container.appendChild(div);
            });
        }

        function loadMenuSelection() {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const container = document.getElementById('menuSelection');
            container.innerHTML = '';

            menus.forEach(m => {
                const div = document.createElement('div');
                div.className = 'selection-item';
                div.textContent = m.name;
                div.onclick = () => selectMenu(m.id, m.name, div);
                container.appendChild(div);
            });
        }

        function loadDurationSelection() {
            if (!selectedMenu) return;
            
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === selectedMenu.id);
            const container = document.getElementById('durationSelection');
            container.innerHTML = '';

            if (menu && menu.prices) {
                Object.keys(menu.prices).forEach(duration => {
                    const div = document.createElement('div');
                    div.className = 'selection-item';
                    const durationKey = `duration${duration}`;
                    div.textContent = translations[currentLanguage][durationKey] || `${duration}분`;
                    div.onclick = () => selectDuration(parseInt(duration), div);
                    container.appendChild(div);
                });
            }
        }

        function loadRoomSelection() {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const roomSelect = document.getElementById('reservationRoom');
            const selectRoomText = translations[currentLanguage].selectRoomOption || '방 선택';
            roomSelect.innerHTML = `<option value="">${selectRoomText}</option>`;
            rooms.forEach(r => {
                roomSelect.innerHTML += `<option value="${r.id}">${r.roomNumber}</option>`;
            });
        }

        function selectStaff(id, name, element) {
            document.querySelectorAll('#staffSelection .selection-item').forEach(item => item.classList.remove('selected'));
            selectedStaff = {id, name};
            element.classList.add('selected');
            document.getElementById('multiMenuSection').classList.remove('hidden');
        }

        function selectMenu(id, name, element) {
            document.querySelectorAll('#menuSelection .selection-item').forEach(item => item.classList.remove('selected'));
            selectedMenu = {id, name};
            element.classList.add('selected');
            selectedDuration = null;
            loadDurationSelection();
            updateReservationDetails();
        }

        function selectDuration(duration, element) {
            document.querySelectorAll('#durationSelection .selection-item').forEach(item => item.classList.remove('selected'));
            selectedDuration = duration;
            element.classList.add('selected');
            updateReservationDetails();
        }

        function updateReservationDetails() {
            let totalPrice = 0;
            let totalCommission = 0;

            pendingReservationItems.forEach(item => {
                totalPrice += item.price;
                totalCommission += item.commission;
            });
            
            document.getElementById('reservationPrice').textContent = totalPrice.toLocaleString();
            document.getElementById('reservationCommission').textContent = totalCommission.toLocaleString();
            updateCurrencyDisplay();
        }
        
        function addMenuItem() {
            if (!selectedStaff) {
                alert(translations[currentLanguage].selectStaff || '마사지사를 선택해주세요.');
                return;
            }
            if (!selectedMenu || !selectedDuration) {
                alert('메뉴와 시간을 선택해주세요.');
                return;
            }

            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === selectedMenu.id);
            const priceData = menu.prices[selectedDuration];

            pendingReservationItems.push({
                menuId: selectedMenu.id,
                menuName: selectedMenu.name,
                duration: selectedDuration,
                price: priceData.price,
                commission: priceData.commission
            });

            // 선택 초기화
            selectedMenu = null;
            selectedDuration = null;
            document.querySelectorAll('#menuSelection .selection-item, #durationSelection .selection-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.getElementById('durationSelection').innerHTML = '';
            
            renderPendingReservations();
            updateReservationDetails();
        }
        
        function renderPendingReservations() {
            const container = document.getElementById('pendingReservationsContainer');
            container.innerHTML = '';
            pendingReservationItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-2 bg-gray-50 rounded mb-2';
                div.innerHTML = `
                    <span>${item.menuName} (${item.duration}분)</span>
                    <button onclick="removePendingItem(${index})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">&times;</button>
                `;
                container.appendChild(div);
            });
        }
        
        function removePendingItem(index) {
            pendingReservationItems.splice(index, 1);
            renderPendingReservations();
            updateReservationDetails();
        }

        function addReservation() {
            if (pendingReservationItems.length === 0) {
                alert('추가된 메뉴가 없습니다. 메뉴를 선택하고 "메뉴 +" 버튼을 눌러주세요.');
                return;
            }

            const startTime = document.getElementById('reservationStartTime').value;
            const roomId = document.getElementById('reservationRoom').value;
            const customerName = document.getElementById('reservationCustomer').value;
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const selectedRoom = rooms.find(r => r.id == roomId);

            pendingReservationItems.forEach(item => {
                const newReservation = {
                    id: Date.now() + Math.random(),
                    date: document.getElementById('currentDate').value,
                    staffId: selectedStaff.id,
                    staffName: selectedStaff.name,
                    menuId: item.menuId,
                    menuName: item.menuName,
                    duration: item.duration,
                    startTime: startTime,
                    roomId: roomId,
                    roomNumber: selectedRoom ? selectedRoom.roomNumber : '',
                    customerName: customerName,
                    price: item.price,
                    commission: item.commission,
                    paid: false,
                    paymentDetails: {}
                };
                reservations.push(newReservation);
            });
            
            localStorage.setItem(getAdminKey('reservations'), JSON.stringify(reservations));
            alert('예약이 추가되었습니다.');
            
            // 초기화
            selectedStaff = null;
            pendingReservationItems = [];
            document.querySelectorAll('.selection-item').forEach(item => item.classList.remove('selected'));
            document.getElementById('multiMenuSection').classList.add('hidden');
            document.getElementById('reservationStartTime').value = '';
            document.getElementById('reservationRoom').value = '';
            document.getElementById('reservationCustomer').value = '';
            renderPendingReservations();
            updateReservationDetails();
            loadStaffSelection();
        }

        // 입금 관련 함수
        function showPaymentModal(reservationId) {
            currentPaymentReservationId = reservationId;
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const reservation = reservations.find(r => r.id === reservationId);
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');

            document.getElementById('paymentTotalAmount').textContent = reservation.price.toLocaleString();
            document.getElementById('paymentCurrency').textContent = currency.symbol;
            document.getElementById('paymentEnteredCurrency').textContent = currency.symbol;
            
            const methodsContainer = document.getElementById('paymentMethods');
            methodsContainer.innerHTML = '';

            paymentMethods.forEach(method => {
                const defaultValue = method.name === '현금' ? reservation.price : 0;
                methodsContainer.innerHTML += `
                    <div class="flex items-center gap-2">
                        <label class="w-20">${method.name}:</label>
                        <input type="number" id="payment_${method.id}" class="border rounded px-2 py-1 flex-1" value="${defaultValue}" onchange="updatePaymentTotal()" inputmode="numeric" pattern="[0-9]*">
                        <span>${currency.symbol}</span>
                    </div>
                `;
            });

            document.getElementById('paymentModal').style.display = 'block';
            updatePaymentTotal();
        }

        function updatePaymentTotal() {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            let total = 0;

            paymentMethods.forEach(method => {
                const input = document.getElementById(`payment_${method.id}`);
                if (input) {
                    total += parseInt(input.value) || 0;
                }
            });

            document.getElementById('paymentEnteredAmount').textContent = total.toLocaleString();
        }

        function processPayment() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const reservationIndex = reservations.findIndex(r => r.id === currentPaymentReservationId);
            if(reservationIndex === -1) return;

            const reservation = reservations[reservationIndex];
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            
            // 입금 방식별 상세 정보 저장
            const paymentDetails = {};
            paymentMethods.forEach(method => {
                const input = document.getElementById(`payment_${method.id}`);
                if (input && parseInt(input.value) > 0) {
                    paymentDetails[method.name] = parseInt(input.value);
                }
            });

            reservations[reservationIndex].paid = true;
            reservations[reservationIndex].paymentDetails = paymentDetails;
            localStorage.setItem(getAdminKey('reservations'), JSON.stringify(reservations));

            alert('입금이 완료되었습니다.');
            closePaymentModal();
            loadDashboard();
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').style.display = 'none';
            currentPaymentReservationId = null;
        }

        // 통계 관련 함수
        function setupDateControls(type) {
            currentStatsType = type;
            const dateRangeContainer = document.getElementById('statsDateRange');
            const confirmBtn = document.getElementById('statsConfirmBtn');
            const startDateInput = document.getElementById('statsDate');
            const endDateInput = document.getElementById('statsEndDate');
            
            const today = new Date();
            
            if (type === 'daily') {
                dateRangeContainer.classList.add('hidden');
                confirmBtn.classList.add('hidden');
                startDateInput.removeEventListener('change', updateStats);
                startDateInput.addEventListener('change', updateStats);
            } else {
                dateRangeContainer.classList.remove('hidden');
                confirmBtn.classList.remove('hidden');
                startDateInput.removeEventListener('change', updateStats);
                
                if (type === 'weekly') {
                    const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay()));
                    const endOfWeek = new Date(startOfWeek);
                    endOfWeek.setDate(startOfWeek.getDate() + 6);
                    startDateInput.value = startOfWeek.toISOString().split('T')[0];
                    endDateInput.value = endOfWeek.toISOString().split('T')[0];
                } else if (type === 'monthly' || type === 'menuChart' || type === 'monthlyChart') {
                    const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                    const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    startDateInput.value = startOfMonth.toISOString().split('T')[0];
                    endDateInput.value = endOfMonth.toISOString().split('T')[0];
                }
            }
        }

        function showDailyStats() {
            setupDateControls('daily');
            updateStats();
        }

        function showWeeklyStats() {
            setupDateControls('weekly');
            updateStats();
        }

        function showMonthlyStats() {
            setupDateControls('monthly');
            updateStats();
        }

        function showMenuChart() {
            setupDateControls('menuChart');
            updateStats();
        }

        function showMonthlyChart() {
            setupDateControls('monthlyChart');
            updateStats();
        }
        
        function updateStats() {
            document.getElementById('chartContainer').style.display = 'none';
            const startDate = document.getElementById('statsDate').value;
            const endDate = document.getElementById('statsEndDate').value;
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            
            let filteredReservations;
            if (currentStatsType === 'daily') {
                filteredReservations = reservations.filter(r => r.date === startDate && r.paid);
            } else {
                filteredReservations = reservations.filter(r => {
                    return r.date >= startDate && r.date <= endDate && r.paid;
                });
            }

            if (currentStatsType === 'menuChart') {
                displayMenuStats(filteredReservations);
            } else if (currentStatsType === 'monthlyChart') {
                displayMonthlySalesStats(filteredReservations);
            } else {
                displayGeneralStats(filteredReservations);
            }
        }
        
        function displayGeneralStats(reservations) {
            // UI 초기화
            document.getElementById('statsTableTitle').textContent = translations[currentLanguage].staffStatisticsTitle || '직원별 통계';
            document.getElementById('paymentStatsContainer').style.display = 'block';
            document.getElementById('statsTableHeader').innerHTML = `
                <tr class="bg-gray-100">
                    <th class="border border-gray-300 p-2" data-translate="staff">마사지사</th>
                    <th class="border border-gray-300 p-2" data-translate="totalPrice">총 가격</th>
                    <th class="border border-gray-300 p-2" data-translate="totalCommission">총 커미션</th>
                </tr>`;
            updateTranslations();
            
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const staffOrder = JSON.parse(localStorage.getItem(getAdminKey('staffOrder')) || '{}');
            const guarantees = JSON.parse(localStorage.getItem(getAdminKey('guarantees')) || '[]');
            const statsTable = document.getElementById('statsTable');
            const paymentStatsTable = document.getElementById('paymentStatsTable');
            const statsDate = document.getElementById('statsDate').value;
            const staffStats = {};
            const paymentStats = {};

            let qrTipTotal = 0;
            
            reservations.forEach(reservation => {
                if (!staffStats[reservation.staffName]) {
                    staffStats[reservation.staffName] = { totalPrice: 0, totalCommission: 0, staffId: reservation.staffId };
                }
                staffStats[reservation.staffName].totalPrice += reservation.price;
                staffStats[reservation.staffName].totalCommission += reservation.commission;

                if (reservation.paymentDetails) {
                    Object.keys(reservation.paymentDetails).forEach(method => {
                        if (!paymentStats[method]) paymentStats[method] = 0;
                        paymentStats[method] += reservation.paymentDetails[method];
                        if (method === 'QR TIP') qrTipTotal += reservation.paymentDetails[method];
                    });
                }
            });

            // Guarantee 적용 로직은 일간 통계에만 적용
            const applyGuarantee = (currentStatsType === 'daily');
            const activeGuarantee = applyGuarantee ? guarantees.find(g => g.startDate <= statsDate && g.endDate >= statsDate) : null;
            
            statsTable.innerHTML = '';
            let grandTotalPrice = 0;
            let grandTotalCommission = 0;

            Object.keys(staffStats).forEach(staffName => {
                const stats = staffStats[staffName];
                let finalCommission = stats.totalCommission;
                
                if (activeGuarantee && stats.staffId) {
                    const staffMember = staff.find(s => s.id === stats.staffId);
                    if (staffMember) {
                        const staffStatus = staffMember.status || '정직원';
                        const staffOrderNum = staffOrder[stats.staffId] !== undefined ? staffOrder[stats.staffId] : 1;
                        if (staffStatus === '정직원' && staffOrderNum !== 0) {
                            if (stats.totalCommission > 0 && stats.totalCommission < activeGuarantee.amount) {
                                finalCommission = activeGuarantee.amount;
                            }
                        }
                    }
                }
                
                grandTotalPrice += stats.totalPrice;
                grandTotalCommission += finalCommission;

                const row = document.createElement('tr');
                const guaranteeApplied = finalCommission > stats.totalCommission;
                const commissionDisplay = (applyGuarantee && guaranteeApplied) ? 
                    `<span class="text-green-600 font-bold">${finalCommission.toLocaleString()}${currency.symbol} (G)</span>` :
                    `${finalCommission.toLocaleString()}${currency.symbol}`;
                
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${staffName}</td>
                    <td class="border border-gray-300 p-2">${stats.totalPrice.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${commissionDisplay}</td>
                `;
                statsTable.appendChild(row);
            });

            paymentStatsTable.innerHTML = '';
            Object.keys(paymentStats).sort().forEach(method => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${method}</td>
                    <td class="border border-gray-300 p-2">${paymentStats[method].toLocaleString()}${currency.symbol}</td>
                `;
                paymentStatsTable.appendChild(row);
            });

            const grandTotalExcludingTip = grandTotalPrice - qrTipTotal;
            const totalProfit = grandTotalExcludingTip - grandTotalCommission;
            
            document.getElementById('grandTotalPrice').textContent = grandTotalExcludingTip.toLocaleString();
            document.getElementById('grandTotalCommission').textContent = grandTotalCommission.toLocaleString();
            document.getElementById('totalProfit').textContent = totalProfit.toLocaleString();
            document.getElementById('grandTotalCurrency').textContent = currency.symbol;
            document.getElementById('grandTotalCommissionCurrency').textContent = currency.symbol;
            document.getElementById('totalProfitCurrency').textContent = currency.symbol;
        }

        function displayMenuStats(reservations) {
            document.getElementById('statsTableTitle').textContent = translations[currentLanguage].menuGraphTitle || '월간 메뉴 그래프';
            document.getElementById('paymentStatsContainer').style.display = 'none';
            document.getElementById('statsTableHeader').innerHTML = `
                <tr class="bg-gray-100">
                    <th class="border border-gray-300 p-2">${translations[currentLanguage].date || '날짜'}</th>
                    <th class="border border-gray-300 p-2">${translations[currentLanguage].menu || '메뉴'}</th>
                    <th class="border border-gray-300 p-2">${translations[currentLanguage].totalPrice || '총 금액'}</th>
                </tr>`;
            updateTranslations();
            
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            const statsTable = document.getElementById('statsTable');
            statsTable.innerHTML = '';
            
            const menuChartData = {};
            let grandTotal = 0;
            
            reservations.sort((a,b) => a.date.localeCompare(b.date)).forEach(res => {
                if (!menuChartData[res.menuName]) menuChartData[res.menuName] = 0;
                menuChartData[res.menuName] += res.price;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${res.date}</td>
                    <td class="border border-gray-300 p-2">${res.menuName}</td>
                    <td class="border border-gray-300 p-2">${res.price.toLocaleString()}${currency.symbol}</td>
                `;
                statsTable.appendChild(row);
                grandTotal += res.price;
            });
            
            // Draw Chart
            const labels = Object.keys(menuChartData);
            const data = Object.values(menuChartData);
            drawChart(labels, data, translations[currentLanguage].menuGraphTitle || '월간 메뉴 그래프', 'pie');
            
            // Update Totals
            document.getElementById('grandTotalPrice').textContent = grandTotal.toLocaleString();
            document.getElementById('grandTotalCommission').textContent = '-';
            document.getElementById('totalProfit').textContent = grandTotal.toLocaleString();
            document.getElementById('grandTotalCurrency').textContent = currency.symbol;
        }
        
        function displayMonthlySalesStats(reservations) {
            document.getElementById('statsTableTitle').textContent = translations[currentLanguage].dailySalesData || '일별 매출 데이터';
            document.getElementById('paymentStatsContainer').style.display = 'none';
            document.getElementById('statsTableHeader').innerHTML = `
                <tr class="bg-gray-100">
                    <th class="border border-gray-300 p-2">${translations[currentLanguage].date || '날짜'}</th>
                    <th class="border border-gray-300 p-2">${translations[currentLanguage].totalPrice || '총 가격'}</th>
                    <th class="border border-gray-300 p-2">${translations[currentLanguage].totalCommission || '총 커미션'}</th>
                    <th class="border border-gray-300 p-2">${translations[currentLanguage].profit || '수익'}</th>
                </tr>`;
             updateTranslations();

            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            const statsTable = document.getElementById('statsTable');
            statsTable.innerHTML = '';

            const dailyData = {};
            reservations.forEach(res => {
                if (!dailyData[res.date]) {
                    dailyData[res.date] = { totalPrice: 0, totalCommission: 0, qrTip: 0 };
                }
                dailyData[res.date].totalPrice += res.price;
                dailyData[res.date].totalCommission += res.commission;
                 if (res.paymentDetails && res.paymentDetails['QR TIP']) {
                    dailyData[res.date].qrTip += res.paymentDetails['QR TIP'];
                }
            });

            let grandTotal = 0;
            let grandCommission = 0;
            const chartLabels = [], chartTotalData = [], chartProfitData = [];

            Object.keys(dailyData).sort().forEach(date => {
                const data = dailyData[date];
                const priceExcludingTip = data.totalPrice - data.qrTip;
                const profit = priceExcludingTip - data.totalCommission;
                grandTotal += priceExcludingTip;
                grandCommission += data.totalCommission;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${date}</td>
                    <td class="border border-gray-300 p-2">${priceExcludingTip.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${data.totalCommission.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${profit.toLocaleString()}${currency.symbol}</td>
                `;
                statsTable.appendChild(row);

                chartLabels.push(date.split('-').slice(1).join('/'));
                chartTotalData.push(priceExcludingTip);
                chartProfitData.push(profit);
            });

            // Draw Chart
            drawDualChart(chartLabels, chartTotalData, chartProfitData, translations[currentLanguage].monthlyChart || '월간 매출 그래프', 'bar');

            // Update Totals
            const grandProfit = grandTotal - grandCommission;
            document.getElementById('grandTotalPrice').textContent = grandTotal.toLocaleString();
            document.getElementById('grandTotalCommission').textContent = grandCommission.toLocaleString();
            document.getElementById('totalProfit').textContent = grandProfit.toLocaleString();
            document.getElementById('grandTotalCurrency').textContent = currency.symbol;
        }

        // DB 관리 함수들
        function manageMenus() {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            
            let content = `
                <div class="mb-4">
                    <button onclick="showAddMenuForm()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">${translations[currentLanguage].newMenuAdd || '새 메뉴 추가'}</button>
                </div>
                <div id="addMenuForm" style="display: none;" class="mb-4 p-4 bg-gray-50 rounded border">
                    <h4 class="font-bold mb-2">${translations[currentLanguage].newMenuAdd || '새 메뉴 추가'}</h4>
                    <div class="grid grid-cols-6 gap-2 mb-2">
                        <input type="text" id="newMenuName" placeholder="${translations[currentLanguage].menuName || '메뉴명'}" class="border rounded px-2 py-1">
                        <div>
                            <input type="number" id="newMenuPrice30" placeholder="${translations[currentLanguage].minutes30 || '30분'} ${translations[currentLanguage].price || '가격'}" class="border rounded px-1 py-1 w-full mb-1">
                            <input type="number" id="newMenuComm30" placeholder="${translations[currentLanguage].minutes30 || '30분'} ${translations[currentLanguage].commission || '커미션'}" class="border rounded px-1 py-1 w-full">
                        </div>
                        <div>
                            <input type="number" id="newMenuPrice60" placeholder="${translations[currentLanguage].minutes60 || '60분'} ${translations[currentLanguage].price || '가격'}" class="border rounded px-1 py-1 w-full mb-1">
                            <input type="number" id="newMenuComm60" placeholder="${translations[currentLanguage].minutes60 || '60분'} ${translations[currentLanguage].commission || '커미션'}" class="border rounded px-1 py-1 w-full">
                        </div>
                        <div>
                            <input type="number" id="newMenuPrice90" placeholder="${translations[currentLanguage].minutes90 || '90분'} ${translations[currentLanguage].price || '가격'}" class="border rounded px-1 py-1 w-full mb-1">
                            <input type="number" id="newMenuComm90" placeholder="${translations[currentLanguage].minutes90 || '90분'} ${translations[currentLanguage].commission || '커미션'}" class="border rounded px-1 py-1 w-full">
                        </div>
                        <div>
                            <input type="number" id="newMenuPrice120" placeholder="${translations[currentLanguage].minutes120 || '120분'} ${translations[currentLanguage].price || '가격'}" class="border rounded px-1 py-1 w-full mb-1">
                            <input type="number" id="newMenuComm120" placeholder="${translations[currentLanguage].minutes120 || '120분'} ${translations[currentLanguage].commission || '커미션'}" class="border rounded px-1 py-1 w-full">
                        </div>
                        <div class="flex flex-col gap-1">
                            <button onclick="saveNewMenu()" class="bg-green-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].add || '추가'}</button>
                            <button onclick="hideAddMenuForm()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].cancel || '취소'}</button>
                        </div>
                    </div>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].menuName || '메뉴명'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].minutes30 || '30분'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].minutes60 || '60분'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].minutes90 || '90분'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].minutes120 || '120분'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].actions || '작업'}</th>
                        </tr>
                    </thead>
                    <tbody id="menuTableBody">
            `;

            menus.forEach(menu => {
                content += `
                    <tr id="menuRow_${menu.id}">
                        <td class="border border-gray-300 p-2">${menu.name}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[30] ? menu.prices[30].price.toLocaleString() + currency.symbol + ' / ' + menu.prices[30].commission.toLocaleString() + currency.symbol : '-'}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[60] ? menu.prices[60].price.toLocaleString() + currency.symbol + ' / ' + menu.prices[60].commission.toLocaleString() + currency.symbol : '-'}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[90] ? menu.prices[90].price.toLocaleString() + currency.symbol + ' / ' + menu.prices[90].commission.toLocaleString() + currency.symbol : '-'}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[120] ? menu.prices[120].price.toLocaleString() + currency.symbol + ' / ' + menu.prices[120].commission.toLocaleString() + currency.symbol : '-'}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editMenu(${menu.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].edit || '수정'}</button>
                            <button onclick="copyMenu(${menu.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].copy || '복사'}</button>
                            <button onclick="deleteMenu(${menu.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].delete || '삭제'}</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = translations[currentLanguage].menuManagement || '메뉴 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function showAddMenuForm() {
            document.getElementById('addMenuForm').style.display = 'block';
        }

        function hideAddMenuForm() {
            document.getElementById('addMenuForm').style.display = 'none';
            clearMenuForm();
        }

        function clearMenuForm() {
            document.getElementById('newMenuName').value = '';
            ['30', '60', '90', '120'].forEach(duration => {
                document.getElementById(`newMenuPrice${duration}`).value = '';
                document.getElementById(`newMenuComm${duration}`).value = '';
            });
        }

        function saveNewMenu() {
            const name = document.getElementById('newMenuName').value;
            if (!name) {
                alert(translations[currentLanguage].requiredFields || '모든 필드를 입력해주세요.');
                return;
            }

            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const newMenu = {
                id: Date.now(),
                name: name,
                prices: {}
            };

            [30, 60, 90, 120].forEach(duration => {
                const price = document.getElementById(`newMenuPrice${duration}`).value;
                const commission = document.getElementById(`newMenuComm${duration}`).value;
                
                if (price && commission && !isNaN(price) && !isNaN(commission) && parseInt(price) > 0) {
                    newMenu.prices[duration] = {
                        price: parseInt(price),
                        commission: parseInt(commission)
                    };
                }
            });

            menus.push(newMenu);
            localStorage.setItem(getAdminKey('menus'), JSON.stringify(menus));
            alert(translations[currentLanguage].menuAdded || '새 메뉴가 추가되었습니다.');
            manageMenus();
        }

        function copyMenu(id) {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === id);
            if (!menu) return;

            const copyText = translations[currentLanguage].copy || '복사';
            const newMenu = {
                id: Date.now(),
                name: menu.name + ` (${copyText})`,
                prices: JSON.parse(JSON.stringify(menu.prices))
            };

            menus.push(newMenu);
            localStorage.setItem(getAdminKey('menus'), JSON.stringify(menus));
            alert(translations[currentLanguage].menuCopied || '메뉴가 복사되었습니다.');
            manageMenus();
        }

        function editMenu(id) {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === id);
            if (!menu) return;

            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            const row = document.getElementById(`menuRow_${id}`);
            
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editName_${id}" value="${menu.name}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editPrice30_${id}" value="${menu.prices[30] ? menu.prices[30].price : ''}" placeholder="가격" class="w-full border rounded px-1 py-1 mb-1">
                    <input type="number" id="editComm30_${id}" value="${menu.prices[30] ? menu.prices[30].commission : ''}" placeholder="커미션" class="w-full border rounded px-1 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editPrice60_${id}" value="${menu.prices[60] ? menu.prices[60].price : ''}" placeholder="가격" class="w-full border rounded px-1 py-1 mb-1">
                    <input type="number" id="editComm60_${id}" value="${menu.prices[60] ? menu.prices[60].commission : ''}" placeholder="커미션" class="w-full border rounded px-1 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editPrice90_${id}" value="${menu.prices[90] ? menu.prices[90].price : ''}" placeholder="가격" class="w-full border rounded px-1 py-1 mb-1">
                    <input type="number" id="editComm90_${id}" value="${menu.prices[90] ? menu.prices[90].commission : ''}" placeholder="커미션" class="w-full border rounded px-1 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editPrice120_${id}" value="${menu.prices[120] ? menu.prices[120].price : ''}" placeholder="가격" class="w-full border rounded px-1 py-1 mb-1">
                    <input type="number" id="editComm120_${id}" value="${menu.prices[120] ? menu.prices[120].commission : ''}" placeholder="커미션" class="w-full border rounded px-1 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveMenu(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageMenus()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveMenu(id) {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === id);
            if (!menu) return;

            menu.name = document.getElementById(`editName_${id}`).value;
            menu.prices = {};

            [30, 60, 90, 120].forEach(duration => {
                const price = document.getElementById(`editPrice${duration}_${id}`).value;
                const commission = document.getElementById(`editComm${duration}_${id}`).value;
                
                if (price && commission && !isNaN(price) && !isNaN(commission) && parseInt(price) > 0) {
                    menu.prices[duration] = {
                        price: parseInt(price),
                        commission: parseInt(commission)
                    };
                }
            });

            localStorage.setItem(getAdminKey('menus'), JSON.stringify(menus));
            manageMenus();
        }

        function deleteMenu(id) {
            if (confirm(translations[currentLanguage].confirmDelete || '정말 삭제하시겠습니까?')) {
                const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
                const filteredMenus = menus.filter(m => m.id !== id);
                localStorage.setItem(getAdminKey('menus'), JSON.stringify(filteredMenus));
                manageMenus();
            }
        }

        function manageStaff() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="showAddStaffForm()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">${translations[currentLanguage].newStaffAdd || '새 직원 추가'}</button>
                </div>
                <div id="addStaffForm" style="display: none;" class="mb-4 p-4 bg-gray-50 rounded border">
                    <h4 class="font-bold mb-2">${translations[currentLanguage].newStaffAdd || '새 직원 추가'}</h4>
                    <div class="grid grid-cols-6 gap-2 mb-2">
                        <input type="text" id="newStaffName" placeholder="${translations[currentLanguage].name || '이름'}" class="border rounded px-2 py-1">
                        <input type="text" id="newStaffPhone" placeholder="${translations[currentLanguage].phoneNumber || '전화번호'}" class="border rounded px-2 py-1">
                        <input type="text" id="newStaffBank" placeholder="${translations[currentLanguage].bankName || '은행명'}" class="border rounded px-2 py-1">
                        <input type="text" id="newStaffAccount" placeholder="${translations[currentLanguage].accountNumber || '계좌번호'}" class="border rounded px-2 py-1">
                        <select id="newStaffStatus" class="border rounded px-2 py-1">
                            <option value="정직원">${translations[currentLanguage].fullTime || '정직원'}</option>
                            <option value="단기고용">${translations[currentLanguage].partTime || '단기고용'}</option>
                            <option value="퇴사">${translations[currentLanguage].resigned || '퇴사'}</option>
                        </select>
                        <div class="flex flex-col gap-1">
                            <button onclick="saveNewStaff()" class="bg-green-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].add || '추가'}</button>
                            <button onclick="hideAddStaffForm()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].cancel || '취소'}</button>
                        </div>
                    </div>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].name || '이름'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].phoneNumber || '전화번호'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].bankName || '은행명'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].accountNumber || '계좌번호'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].status || '상태'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].actions || '작업'}</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            staff.forEach(s => {
                const statusKey = s.status === '정직원' ? 'fullTime' : s.status === '단기고용' ? 'partTime' : s.status === '퇴사' ? 'resigned' : 'fullTime';
                const statusText = translations[currentLanguage][statusKey] || s.status;
                
                content += `
                    <tr id="staffRow_${s.id}">
                        <td class="border border-gray-300 p-2">${s.name}</td>
                        <td class="border border-gray-300 p-2">${s.phone}</td>
                        <td class="border border-gray-300 p-2">${s.bank}</td>
                        <td class="border border-gray-300 p-2">${s.account}</td>
                        <td class="border border-gray-300 p-2">${statusText}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editStaff(${s.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].edit || '수정'}</button>
                            <button onclick="copyStaff(${s.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].copy || '복사'}</button>
                            <button onclick="deleteStaff(${s.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].delete || '삭제'}</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = translations[currentLanguage].staffManagement || '직원 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function showAddStaffForm() {
            document.getElementById('addStaffForm').style.display = 'block';
        }

        function hideAddStaffForm() {
            document.getElementById('addStaffForm').style.display = 'none';
            clearStaffForm();
        }

        function clearStaffForm() {
            document.getElementById('newStaffName').value = '';
            document.getElementById('newStaffPhone').value = '';
            document.getElementById('newStaffBank').value = '';
            document.getElementById('newStaffAccount').value = '';
            document.getElementById('newStaffStatus').value = '정직원';
        }

        function saveNewStaff() {
            const name = document.getElementById('newStaffName').value;
            const phone = document.getElementById('newStaffPhone').value;
            
            if (!name || !phone) {
                alert(translations[currentLanguage].namePhoneRequired || '이름과 전화번호는 필수입니다.');
                return;
            }

            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const newStaff = {
                id: Date.now(),
                name: name,
                phone: phone,
                bank: document.getElementById('newStaffBank').value || '',
                account: document.getElementById('newStaffAccount').value || '',
                status: document.getElementById('newStaffStatus').value
            };
            staff.push(newStaff);
            localStorage.setItem(getAdminKey('staff'), JSON.stringify(staff));
            alert(translations[currentLanguage].staffAdded || '새 직원이 추가되었습니다.');
            manageStaff();
        }

        function copyStaff(id) {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const member = staff.find(s => s.id === id);
            if (!member) return;

            const newStaff = {
                id: Date.now(),
                name: member.name + ' (복사)',
                phone: member.phone,
                bank: member.bank,
                account: member.account
            };

            staff.push(newStaff);
            localStorage.setItem(getAdminKey('staff'), JSON.stringify(staff));
            alert('직원이 복사되었습니다.');
            manageStaff();
        }

        function editStaff(id) {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const member = staff.find(s => s.id === id);
            if (!member) return;

            const row = document.getElementById(`staffRow_${id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editStaffName_${id}" value="${member.name}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editStaffPhone_${id}" value="${member.phone}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editStaffBank_${id}" value="${member.bank}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editStaffAccount_${id}" value="${member.account}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <select id="editStaffStatus_${id}" class="w-full border rounded px-2 py-1">
                        <option value="정직원" ${(member.status || '정직원') === '정직원' ? 'selected' : ''}>${translations[currentLanguage].fullTime || '정직원'}</option>
                        <option value="단기고용" ${member.status === '단기고용' ? 'selected' : ''}>${translations[currentLanguage].partTime || '단기고용'}</option>
                        <option value="퇴사" ${member.status === '퇴사' ? 'selected' : ''}>${translations[currentLanguage].resigned || '퇴사'}</option>
                    </select>
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveStaff(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageStaff()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveStaff(id) {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const member = staff.find(s => s.id === id);
            if (!member) return;

            member.name = document.getElementById(`editStaffName_${id}`).value;
            member.phone = document.getElementById(`editStaffPhone_${id}`).value;
            member.bank = document.getElementById(`editStaffBank_${id}`).value;
            member.account = document.getElementById(`editStaffAccount_${id}`).value;
            member.status = document.getElementById(`editStaffStatus_${id}`).value;

            localStorage.setItem(getAdminKey('staff'), JSON.stringify(staff));
            manageStaff();
        }

        function deleteStaff(id) {
            if (confirm(translations[currentLanguage].confirmDelete || '정말 삭제하시겠습니까?')) {
                const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
                const filteredStaff = staff.filter(s => s.id !== id);
                localStorage.setItem(getAdminKey('staff'), JSON.stringify(filteredStaff));
                manageStaff();
            }
        }

        function manageCurrency() {
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            
            let content = `
                <div class="mb-4">
                    <h4 class="text-lg font-bold mb-2">${translations[currentLanguage].currencySettings || '화폐 단위 설정'}</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">${translations[currentLanguage].currencySymbol || '화폐 기호'}:</label>
                            <select id="currencySymbol" class="w-full border rounded px-3 py-2">
                                <option value="" ${currency.symbol === '' ? 'selected' : ''}>${translations[currentLanguage].none || '없음'} (${translations[currentLanguage].numbersOnly || '숫자만'})</option>
                                <option value="₩" ${currency.symbol === '₩' ? 'selected' : ''}>₩ (${translations[currentLanguage].won || '원'})</option>
                                <option value="$" ${currency.symbol === '$' ? 'selected' : ''}>$ (${translations[currentLanguage].dollar || '달러'})</option>
                                <option value="€" ${currency.symbol === '€' ? 'selected' : ''}>€ (${translations[currentLanguage].euro || '유로'})</option>
                                <option value="¥" ${currency.symbol === '¥' ? 'selected' : ''}>¥ (${translations[currentLanguage].yen || '엔'})</option>
                                <option value="£" ${currency.symbol === '£' ? 'selected' : ''}>£ (${translations[currentLanguage].pound || '파운드'})</option>
                                <option value="฿" ${currency.symbol === '฿' ? 'selected' : ''}>฿ (${translations[currentLanguage].baht || '바트'})</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">${translations[currentLanguage].currencyName || '화폐 이름'}:</label>
                            <input type="text" id="currencyName" value="${currency.name}" class="w-full border rounded px-3 py-2">
                        </div>
                    </div>
                    <button onclick="saveCurrency()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">${translations[currentLanguage].save || '저장'}</button>
                </div>
            `;

            document.getElementById('managementTitle').textContent = translations[currentLanguage].currencyManagement || '화폐 단위 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function saveCurrency() {
            const symbol = document.getElementById('currencySymbol').value;
            const name = document.getElementById('currencyName').value;
            
            const currency = { symbol, name };
            localStorage.setItem(getAdminKey('currency'), JSON.stringify(currency));
            
            alert(translations[currentLanguage].currencySaved || '화폐 단위가 저장되었습니다.');
            updateCurrencyDisplay();
            closeManagementModal();
        }

        // 기타 관리 함수들 (간단 구현)
        function manageRooms() {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewRoom()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">${translations[currentLanguage].newRoomAdd || '새 방 추가'}</button>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].roomNum || '방번호'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].roomCapacity || '수용인원'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].actions || '작업'}</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            rooms.forEach(room => {
                const capacityText = translations[currentLanguage].peopleUnit || '명';
                content += `
                    <tr id="roomRow_${room.id}">
                        <td class="border border-gray-300 p-2">${room.roomNumber}</td>
                        <td class="border border-gray-300 p-2">${room.capacity}${capacityText}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editRoom(${room.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].edit || '수정'}</button>
                            <button onclick="copyRoom(${room.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].copy || '복사'}</button>
                            <button onclick="deleteRoom(${room.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].delete || '삭제'}</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = translations[currentLanguage].roomManagement || '방 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }
        
        function manageCustomers() {
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewCustomer()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">${translations[currentLanguage].newCustomerAdd || '새 고객 추가'}</button>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].customerName || '고객명'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].phoneNumber || '전화번호'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].customerNum || '고객번호'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].actions || '작업'}</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            customers.forEach(customer => {
                content += `
                    <tr id="customerRow_${customer.id}">
                        <td class="border border-gray-300 p-2">${customer.name}</td>
                        <td class="border border-gray-300 p-2">${customer.phone}</td>
                        <td class="border border-gray-300 p-2">${customer.customerNumber}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editCustomer(${customer.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].edit || '수정'}</button>
                            <button onclick="copyCustomer(${customer.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].copy || '복사'}</button>
                            <button onclick="deleteCustomer(${customer.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].delete || '삭제'}</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = translations[currentLanguage].customerManagement || '고객 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }
        
        function managePaymentMethods() {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewPaymentMethod()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">${translations[currentLanguage].newPaymentMethodAdd || '새 입금방식 추가'}</button>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].paymentMethodName || '입금방식명'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].actions || '작업'}</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            paymentMethods.forEach(method => {
                content += `
                    <tr id="paymentMethodRow_${method.id}">
                        <td class="border border-gray-300 p-2">${method.name}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editPaymentMethod(${method.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].edit || '수정'}</button>
                            <button onclick="copyPaymentMethod(${method.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].copy || '복사'}</button>
                            <button onclick="deletePaymentMethod(${method.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].delete || '삭제'}</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = translations[currentLanguage].paymentMethodManagement || '입금방식 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }
        
        function manageAdmins() {
            if (currentAdmin.type !== 'super') {
                alert(translations[currentLanguage].superAdminOnly || '최고관리자만 접근 가능합니다.');
                return;
            }
            
            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="showAddAdminForm()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">${translations[currentLanguage].newAdminAdd || '새 관리자 추가'}</button>
                </div>
                <div id="addAdminForm" style="display: none;" class="mb-4 p-4 bg-gray-50 rounded border">
                    <h4 class="font-bold mb-2">${translations[currentLanguage].newAdminAdd || '새 관리자 추가'}</h4>
                    <div class="grid grid-cols-5 gap-2 mb-2">
                        <input type="text" id="newAdminUsername" placeholder="${translations[currentLanguage].username || '아이디'}" class="border rounded px-2 py-1">
                        <input type="password" id="newAdminPassword" placeholder="${translations[currentLanguage].password || '비밀번호'}" class="border rounded px-2 py-1">
                        <input type="text" id="newAdminShopName" placeholder="${translations[currentLanguage].shopName || '가게명'}" class="border rounded px-2 py-1">
                        <input type="text" id="newAdminPhone" placeholder="${translations[currentLanguage].phoneNumber || '전화번호'}" class="border rounded px-2 py-1">
                        <div class="flex flex-col gap-1">
                            <button onclick="saveNewAdmin()" class="bg-green-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].add || '추가'}</button>
                            <button onclick="hideAddAdminForm()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].cancel || '취소'}</button>
                        </div>
                    </div>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].username || '아이디'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].adminType || '타입'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].shopName || '가게명'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].phoneNumber || '전화번호'}</th>
                            <th class="border border-gray-300 p-2">${translations[currentLanguage].actions || '작업'}</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            admins.forEach(admin => {
                const adminTypeText = admin.type === 'super' ? 
                    (translations[currentLanguage].superAdmin || '최고관리자') : 
                    (translations[currentLanguage].normalAdmin || '일반관리자');
                
                content += `
                    <tr id="adminRow_${admin.id}">
                        <td class="border border-gray-300 p-2">${admin.username}</td>
                        <td class="border border-gray-300 p-2">${adminTypeText}</td>
                        <td class="border border-gray-300 p-2">${admin.shopName || '-'}</td>
                        <td class="border border-gray-300 p-2">${admin.phone || '-'}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editAdmin(${admin.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].edit || '수정'}</button>
                            <button onclick="changeAdminPassword(${admin.id})" class="bg-purple-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].password || '비밀번호'}</button>
                            <button onclick="copyAdmin(${admin.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].copy || '복사'}</button>
                            ${admin.type !== 'super' ? `<button onclick="deleteAdmin(${admin.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].delete || '삭제'}</button>` : ''}
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = translations[currentLanguage].adminManagement || '관리자 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function deleteReservation(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
                const filteredReservations = reservations.filter(r => r.id !== id);
                localStorage.setItem(getAdminKey('reservations'), JSON.stringify(filteredReservations));
                loadDashboard();
            }
        }
        
        function editReservation(id) {
            currentEditingReservationId = id;
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const reservation = reservations.find(r => r.id === id);
            if (!reservation) return;

            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menuSelect = document.getElementById('editMenuSelect');
            const durationSelect = document.getElementById('editDurationSelect');
            
            menuSelect.innerHTML = '';
            menus.forEach(menu => {
                const option = new Option(menu.name, menu.id);
                if (menu.id === reservation.menuId) option.selected = true;
                menuSelect.appendChild(option);
            });
            
            function populateDurations() {
                const selectedMenuId = parseInt(menuSelect.value);
                const selectedMenu = menus.find(m => m.id === selectedMenuId);
                durationSelect.innerHTML = '';
                if (selectedMenu && selectedMenu.prices) {
                    Object.keys(selectedMenu.prices).forEach(duration => {
                        const option = new Option(`${duration}분`, duration);
                        if (parseInt(duration) === reservation.duration && selectedMenuId === reservation.menuId) option.selected = true;
                        durationSelect.appendChild(option);
                    });
                }
            }
            
            populateDurations();
            menuSelect.onchange = populateDurations;

            document.getElementById('editStartTime').value = reservation.startTime;
            document.getElementById('editReservationModal').style.display = 'block';
        }

        function saveEditedReservation() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const reservationIndex = reservations.findIndex(r => r.id === currentEditingReservationId);
            if (reservationIndex === -1) return;

            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const newMenuId = parseInt(document.getElementById('editMenuSelect').value);
            const newDuration = parseInt(document.getElementById('editDurationSelect').value);
            const newStartTime = document.getElementById('editStartTime').value;
            
            const selectedMenu = menus.find(m => m.id === newMenuId);
            if (!selectedMenu || !selectedMenu.prices[newDuration]) {
                alert('유효하지 않은 메뉴 또는 시간입니다.');
                return;
            }
            
            const priceData = selectedMenu.prices[newDuration];

            reservations[reservationIndex].menuId = newMenuId;
            reservations[reservationIndex].menuName = selectedMenu.name;
            reservations[reservationIndex].duration = newDuration;
            reservations[reservationIndex].startTime = newStartTime;
            reservations[reservationIndex].price = priceData.price;
            reservations[reservationIndex].commission = priceData.commission;

            localStorage.setItem(getAdminKey('reservations'), JSON.stringify(reservations));
            closeEditReservationModal();
            loadDashboard();
        }

        function closeEditReservationModal() {
            document.getElementById('editReservationModal').style.display = 'none';
            currentEditingReservationId = null;
        }

        // 방 관리 함수들
        function addNewRoom() {
            const roomNumber = prompt(translations[currentLanguage].enterRoomNumber || '방번호를 입력하세요:');
            if (!roomNumber) return;
            
            const capacity = prompt(translations[currentLanguage].enterCapacity || '수용인원을 입력하세요:');
            if (!capacity || isNaN(capacity) || parseInt(capacity) <= 0) {
                alert(translations[currentLanguage].validCapacity || '올바른 수용인원을 입력해주세요.');
                return;
            }

            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const newRoom = {
                id: Date.now(),
                roomNumber: roomNumber,
                capacity: parseInt(capacity)
            };
            rooms.push(newRoom);
            localStorage.setItem(getAdminKey('rooms'), JSON.stringify(rooms));
            alert(translations[currentLanguage].roomAdded || '새 방이 추가되었습니다.');
            manageRooms();
        }

        function editRoom(id) {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const room = rooms.find(r => r.id === id);
            if (!room) return;

            const row = document.getElementById(`roomRow_${id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editRoomNumber_${id}" value="${room.roomNumber}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editRoomCapacity_${id}" value="${room.capacity}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveRoom(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageRooms()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveRoom(id) {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const room = rooms.find(r => r.id === id);
            if (!room) return;

            room.roomNumber = document.getElementById(`editRoomNumber_${id}`).value;
            room.capacity = parseInt(document.getElementById(`editRoomCapacity_${id}`).value);

            localStorage.setItem(getAdminKey('rooms'), JSON.stringify(rooms));
            manageRooms();
        }

        function deleteRoom(id) {
            if (confirm(translations[currentLanguage].confirmDelete || '정말 삭제하시겠습니까?')) {
                const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
                const filteredRooms = rooms.filter(r => r.id !== id);
                localStorage.setItem(getAdminKey('rooms'), JSON.stringify(filteredRooms));
                manageRooms();
            }
        }

        // 고객 관리 함수들
        function addNewCustomer() {
            const name = prompt(translations[currentLanguage].enterCustomerNamePrompt || '고객명을 입력하세요:');
            if (!name) return;
            
            const phone = prompt(translations[currentLanguage].enterPhonePrompt || '전화번호를 입력하세요:');
            if (!phone) return;
            
            const customerNumber = prompt(translations[currentLanguage].enterCustomerNumberPrompt || '고객번호를 입력하세요:');
            if (!customerNumber) return;

            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            
            // 중복 고객번호 체크
            if (customers.find(c => c.customerNumber === customerNumber)) {
                alert(translations[currentLanguage].duplicateCustomerNumber || '이미 존재하는 고객번호입니다.');
                return;
            }
            
            const newCustomer = {
                id: Date.now(),
                name: name,
                phone: phone,
                customerNumber: customerNumber
            };
            customers.push(newCustomer);
            localStorage.setItem(getAdminKey('customers'), JSON.stringify(customers));
            alert(translations[currentLanguage].customerAdded || '새 고객이 추가되었습니다.');
            manageCustomers();
        }

        function editCustomer(id) {
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            const customer = customers.find(c => c.id === id);
            if (!customer) return;

            const row = document.getElementById(`customerRow_${id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editCustomerName_${id}" value="${customer.name}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editCustomerPhone_${id}" value="${customer.phone}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editCustomerNumber_${id}" value="${customer.customerNumber}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveCustomer(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageCustomers()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveCustomer(id) {
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            const customer = customers.find(c => c.id === id);
            if (!customer) return;

            customer.name = document.getElementById(`editCustomerName_${id}`).value;
            customer.phone = document.getElementById(`editCustomerPhone_${id}`).value;
            customer.customerNumber = document.getElementById(`editCustomerNumber_${id}`).value;

            localStorage.setItem(getAdminKey('customers'), JSON.stringify(customers));
            manageCustomers();
        }

        function deleteCustomer(id) {
            if (confirm(translations[currentLanguage].confirmDelete || '정말 삭제하시겠습니까?')) {
                const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
                const filteredCustomers = customers.filter(c => c.id !== id);
                localStorage.setItem(getAdminKey('customers'), JSON.stringify(filteredCustomers));
                manageCustomers();
            }
        }

        // 입금방식 관리 함수들
        function addNewPaymentMethod() {
            const name = prompt(translations[currentLanguage].enterPaymentMethodName || '입금방식명을 입력하세요:');
            if (!name) return;

            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            
            // 중복 입금방식 체크
            if (paymentMethods.find(m => m.name === name)) {
                alert(translations[currentLanguage].duplicatePaymentMethod || '이미 존재하는 입금방식입니다.');
                return;
            }
            
            const newMethod = {
                id: Date.now(),
                name: name
            };
            paymentMethods.push(newMethod);
            localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(paymentMethods));
            alert(translations[currentLanguage].paymentMethodAdded || '새 입금방식이 추가되었습니다.');
            managePaymentMethods();
        }

        function editPaymentMethod(id) {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const method = paymentMethods.find(m => m.id === id);
            if (!method) return;

            const row = document.getElementById(`paymentMethodRow_${method.id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editPaymentMethodName_${id}" value="${method.name}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="savePaymentMethod(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="managePaymentMethods()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function savePaymentMethod(id) {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const method = paymentMethods.find(m => m.id === id);
            if (!method) return;

            method.name = document.getElementById(`editPaymentMethodName_${id}`).value;

            localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(paymentMethods));
            managePaymentMethods();
        }

        function deletePaymentMethod(id) {
            if (confirm(translations[currentLanguage].confirmDelete || '정말 삭제하시겠습니까?')) {
                const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
                const filteredMethods = paymentMethods.filter(m => m.id !== id);
                localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(filteredMethods));
                managePaymentMethods();
            }
        }

        // 관리자 관리 함수들
        function addNewAdmin() {
            const username = prompt('아이디를 입력하세요:');
            if (!username) return;
            
            const password = prompt('비밀번호를 입력하세요:');
            if (!password) return;
            
            const shopName = prompt('가게명을 입력하세요:');
            const phone = prompt('전화번호를 입력하세요:');

            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            
            // 중복 아이디 체크
            if (admins.find(a => a.username === username)) {
                alert('이미 존재하는 아이디입니다.');
                return;
            }

            const newAdmin = {
                id: Date.now(),
                username: username,
                password: password,
                type: 'normal',
                shopName: shopName || '',
                phone: phone || ''
            };
            admins.push(newAdmin);
            localStorage.setItem('globalAdmins', JSON.stringify(admins));
            alert('새 관리자가 추가되었습니다.');
            manageAdmins();
        }

        function editAdmin(id) {
            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.id === id);
            if (!admin) return;

            const row = document.getElementById(`adminRow_${admin.id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editAdminUsername_${id}" value="${admin.username}" class="w-full border rounded px-2 py-1" ${admin.type === 'super' ? 'readonly' : ''}>
                </td>
                <td class="border border-gray-300 p-2">
                    <select id="editAdminType_${id}" class="w-full border rounded px-2 py-1" ${admin.type === 'super' ? 'disabled' : ''}>
                        <option value="normal" ${admin.type === 'normal' ? 'selected' : ''}>일반관리자</option>
                        <option value="super" ${admin.type === 'super' ? 'selected' : ''}>최고관리자</option>
                    </select>
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editAdminShopName_${id}" value="${admin.shopName || ''}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editAdminPhone_${id}" value="${admin.phone || ''}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveAdmin(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageAdmins()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveAdmin(id) {
            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.id === id);
            if (!admin) return;

            if (admin.type !== 'super') {
                admin.username = document.getElementById(`editAdminUsername_${id}`).value;
                admin.type = document.getElementById(`editAdminType_${id}`).value;
            }
            admin.shopName = document.getElementById(`editAdminShopName_${id}`).value;
            admin.phone = document.getElementById(`editAdminPhone_${id}`).value;

            localStorage.setItem('globalAdmins', JSON.stringify(admins));
            manageAdmins();
        }

        function deleteAdmin(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
                const filteredAdmins = admins.filter(a => a.id !== id);
                localStorage.setItem('globalAdmins', JSON.stringify(filteredAdmins));
                manageAdmins();
            }
        }

        function closeManagementModal() {
            document.getElementById('managementModal').style.display = 'none';
        }

        function showLanguageModal() {
            document.getElementById('languageModal').style.display = 'block';
        }

        function closeLanguageModal() {
            document.getElementById('languageModal').style.display = 'none';
        }

        function setLanguageAndClose(lang) {
            setLanguage(lang);
            closeLanguageModal();
        }

        // 폰트 관리 함수들
        function showFontModal() {
            // 현재 설정을 모달에 반영
            updateFontModalSelection();
            updateFontPreview();
            document.getElementById('fontModal').style.display = 'block';
        }

        function closeFontModal() {
            document.getElementById('fontModal').style.display = 'none';
        }

        function updateFontModalSelection() {
            // 폰트 크기 버튼 업데이트
            const fontSizeButtons = ['fontSizeSmall', 'fontSizeNormal', 'fontSizeLarge', 'fontSizeXLarge', 'fontSizeXXLarge'];
            fontSizeButtons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                const size = buttonId.replace('fontSize', '').toLowerCase();
                if (size === selectedFontSize) {
                    button.className = 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600';
                } else {
                    button.className = 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
                }
            });

            // 폰트 종류 버튼 업데이트
            const fontFamilyButtons = ['fontFamilyArial', 'fontFamilyNotoKR', 'fontFamilyMalgun', 'fontFamilyNanum', 'fontFamilyRoboto', 'fontFamilyThai', 'fontFamilyVietnamese'];
            fontFamilyButtons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                const fontName = getFontNameFromButtonId(buttonId);
                if (fontName === selectedFontFamily) {
                    button.className = 'bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600';
                } else {
                    button.className = 'bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400';
                }
            });
        }

        function getFontNameFromButtonId(buttonId) {
            const fontMap = {
                'fontFamilyArial': 'Arial',
                'fontFamilyNotoKR': 'Noto Sans KR',
                'fontFamilyMalgun': 'Malgun Gothic',
                'fontFamilyNanum': 'Nanum Gothic',
                'fontFamilyRoboto': 'Roboto',
                'fontFamilyThai': 'Noto Sans Thai',
                'fontFamilyVietnamese': 'Noto Sans Vietnamese'
            };
            return fontMap[buttonId] || 'Arial';
        }

        function setFontSize(size) {
            selectedFontSize = size;
            updateFontModalSelection();
            updateFontPreview();
        }

        function setFontFamily(font) {
            selectedFontFamily = font;
            updateFontModalSelection();
            updateFontPreview();
        }

        function updateFontPreview() {
            const preview = document.getElementById('fontSizePreview');
            if (preview) {
                const fontFamily = getFontFamilyCSS(selectedFontFamily);
                const fontSize = getFontSizeCSS(selectedFontSize);
                
                preview.style.fontFamily = fontFamily;
                preview.style.fontSize = fontSize;
            }
        }

        function getFontFamilyCSS(font) {
            switch(font) {
                case 'Noto Sans KR':
                    return "'Noto Sans KR', sans-serif";
                case 'Malgun Gothic':
                    return "'Malgun Gothic', sans-serif";
                case 'Nanum Gothic':
                    return "'Nanum Gothic', sans-serif";
                case 'Roboto':
                    return "'Roboto', sans-serif";
                case 'Noto Sans Thai':
                    return "'Noto Sans Thai', sans-serif";
                case 'Noto Sans Vietnamese':
                    return "'Noto Sans Vietnamese', sans-serif";
                default:
                    return "Arial, sans-serif";
            }
        }

        function getFontSizeCSS(size) {
            switch(size) {
                case 'small':
                    return '12px';
                case 'normal':
                    return '14px';
                case 'large':
                    return '16px';
                case 'xlarge':
                    return '18px';
                case 'xxlarge':
                    return '20px';
                default:
                    return '14px';
            }
        }

        function applyFontSettings() {
            currentFont = selectedFontFamily;
            currentFontSize = selectedFontSize;
            
            // 로컬 스토리지에 저장
            localStorage.setItem('selectedFont', selectedFontFamily);
            localStorage.setItem('selectedFontSize', selectedFontSize);
            
            const fontFamily = getFontFamilyCSS(selectedFontFamily);
            const fontSize = getFontSizeCSS(selectedFontSize);
            
            // body에 기본 폰트 설정
            document.body.style.fontFamily = fontFamily;
            document.body.style.fontSize = fontSize;
            
            // 모든 요소에 폰트 적용
            const allElements = document.querySelectorAll('*');
            allElements.forEach(element => {
                element.style.fontFamily = fontFamily;
                element.style.fontSize = fontSize;
            });
            
            closeFontModal();
        }

        // 데이터 백업 및 복원 함수들
        let currentGoogleAction = null;

        function showLocalBackupDialog() {
            if (window.showDirectoryPicker) {
                // 최신 브라우저에서 폴더 선택 지원
                window.showDirectoryPicker().then(directoryHandle => {
                    backupDataLocal(directoryHandle);
                }).catch(err => {
                    if (err.name !== 'AbortError') {
                        // 폴더 선택이 지원되지 않는 경우 기본 다운로드
                        backupDataLocal();
                    }
                });
            } else {
                // 폴더 선택이 지원되지 않는 경우 기본 다운로드
                backupDataLocal();
            }
        }

        function showLocalRestoreDialog() {
            if (window.showDirectoryPicker) {
                // 최신 브라우저에서 폴더 선택 지원
                window.showDirectoryPicker().then(directoryHandle => {
                    // 폴더에서 JSON 파일 찾기
                    showFileSelectionFromDirectory(directoryHandle);
                }).catch(err => {
                    if (err.name !== 'AbortError') {
                        // 폴더 선택이 지원되지 않는 경우 파일 선택
                        document.getElementById('restoreFile').click();
                    }
                });
            } else {
                // 폴더 선택이 지원되지 않는 경우 파일 선택
                document.getElementById('restoreFile').click();
            }
        }

        function showGoogleBackupDialog() {
            currentGoogleAction = 'backup';
            document.getElementById('googleLoginModal').style.display = 'block';
        }

        function showGoogleRestoreDialog() {
            currentGoogleAction = 'restore';
            document.getElementById('googleLoginModal').style.display = 'block';
        }

        function closeGoogleLoginModal() {
            document.getElementById('googleLoginModal').style.display = 'none';
            document.getElementById('googleEmail').value = '';
            document.getElementById('googlePassword').value = '';
            currentGoogleAction = null;
        }

        function processGoogleLogin() {
            const email = document.getElementById('googleEmail').value;
            const password = document.getElementById('googlePassword').value;
            
            if (!email || !password) {
                alert('이메일과 비밀번호를 모두 입력해주세요.');
                return;
            }

            // 실제 구글 API 연동은 보안상 제한되므로 시뮬레이션
            alert('보안상의 이유로 실제 구글 계정 연동은 제한됩니다. 로컬 백업/복원을 사용해주세요.');
            closeGoogleLoginModal();
            
            if (currentGoogleAction === 'backup') {
                backupDataLocal();
            } else if (currentGoogleAction === 'restore') {
                document.getElementById('restoreFile').click();
            }
        }

        async function showFileSelectionFromDirectory(directoryHandle) {
            try {
                const files = [];
                for await (const [name, handle] of directoryHandle.entries()) {
                    if (handle.kind === 'file' && name.endsWith('.json')) {
                        files.push({name, handle});
                    }
                }
                
                if (files.length === 0) {
                    alert('선택한 폴더에 JSON 백업 파일이 없습니다.');
                    return;
                }
                
                // 파일 선택 다이얼로그 표시
                let fileList = '복원할 파일을 선택하세요:\n\n';
                files.forEach((file, index) => {
                    fileList += `${index + 1}. ${file.name}\n`;
                });
                
                const selection = prompt(fileList + '\n번호를 입력하세요:');
                const fileIndex = parseInt(selection) - 1;
                
                if (fileIndex >= 0 && fileIndex < files.length) {
                    const fileHandle = files[fileIndex].handle;
                    const file = await fileHandle.getFile();
                    const text = await file.text();
                    
                    try {
                        const data = JSON.parse(text);
                        if (confirm('기존 데이터를 덮어쓰시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                            Object.keys(data).forEach(key => {
                                localStorage.setItem(key, data[key]);
                            });
                            alert('데이터가 복원되었습니다. 페이지를 새로고침합니다.');
                            location.reload();
                        }
                    } catch (error) {
                        alert('잘못된 백업 파일입니다.');
                    }
                }
            } catch (error) {
                alert('폴더에서 파일을 읽는 중 오류가 발생했습니다.');
            }
        }

        async function backupDataLocal(directoryHandle = null) {
            const adminData = {};
            const keys = Object.keys(localStorage);
            
            keys.forEach(key => {
                if (key.startsWith(currentAdmin.username + '_')) {
                    adminData[key] = localStorage

